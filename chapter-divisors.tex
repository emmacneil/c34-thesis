%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%              %%%%%
%%%%%   Divisors   %%%%%
%%%%%              %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%

\section{The Divisor Class Group}
\label{chap_divisors}

The main matter of this thesis is to describe efficient arithmetic in the divisor class group of a $C_{3,4}$ curve,
so we come now to defining that group.
We begin with a description of divisors on a curve.
Divisors on a curve $C$ form an Abelian group, $\Div(C)$, of which we will describe several subgroups,
most notably the subgroups $\Div_K^0(C)$ and $\Princ(C)$.
The divisor class group is the quotient of these two subgroups.

We will assume that $C$ is a $C_{3,4}$ curve,
though the definitions given in this chapter up to and including the divisor class group
work equally well for any curve.
Some facts towards the end of the chapter related to a partial order $(\Div_K^0(C), \leq)$,
including a characterization of prime divisors,
depend on the fact that a $C_{3,4}$ curve has a unique point at infinity, $P_{\infty}$.



\subsection{Divisors}

Let $C$ be a $C_{3,4}$ curve.
A \defn{divisor} $D$ of $C$ is a formal sum of points in $C(\bar K)$,
including possibly the point at infinity, $P_\infty$.
If $P$, $Q$, and $R$ are points on the curve $C$, then examples of divisors include
  \[ \begin{array}{c} P + Q + R - 3P_\infty, \\ P + 3Q - 2R, \\ Q, \\ 0. \end{array} \]
More generally, a divisor has the form
  \[ D = \sum_{P \in C(\bar K)} n_P P,\]
where only finitely many $n_P$'s are non-zero.

A divisor is an element free Abelian group generated by the set of points $C(\bar K)$.
This Abelian group is denoted by $\Div(C)$.
Addition and negation are defined in the obvious way:
\[ \left( \sum_{P \in C(\bar K)} n_P P \right) + \left( \sum_{P \in C(\bar K)} m_P P \right) = \sum_{P \in C(\bar K)} (n_P + m_P) P \]
\[ -\left( \sum_{P \in C(\bar K)} n_P P \right) = \sum_{P \in C(\bar K)} (-n_P) P. \]

The coefficient $n_P$ of $P$ is the \defn{order} of the divisor $D$ at $P$, denoted by $\ord_P(D)$.
For example, if $D = P + 3Q - 2R$, then $\ord_Q(D) = 3$ and $\ord_R(D) = -2$.
The \defn{degree} of a divisor $D$, denoted by $\deg(D)$, is the sum of its orders at each point on the curve:
  \[ \deg(D) = \sum_{P \in C(\bar K)} \ord_P(D). \]
For example, $\deg(P + 3Q - 2R) = 1 + 3 - 2 = 2$.

The \defn{support} of a divisor, denoted $\supp(D)$, is the set of points $P$ with $\ord_P(D) \neq 0$,
\[ \supp(D) := \{ P \in C(\bar K) ~|~ \ord_P(D) \neq 0 \}. \]

It is easily verified that the map $\deg$ and the family of maps $\ord_P$ have the additive properties
  \[ \ord_P(A + B) = \ord_P(A) + \ord_P(B) \]
  \[ \deg(A + B) = \deg(A) + \deg(B). \]
In fact, $\ord_P$ and $\deg$ are group homomorphisms $\Div(C) \to \bb Z$.

There is a partial order $\preceq$ on divisors.
For two divisors $D,D' \in \Div(C)$,
we order them
  \[ D \preceq D' \iff \forall P \in C(\bar K) : \ord_P(D) \leq \ord_P(D'). \]
The divisor $D$ precedes or is equal to $D'$
if its order is no greater than that of $D'$ at every point.
This partial order is compatible with addition, in the sense that for any divisors $A$, $B$, and $D$,
  \[ A \preceq B \implies A + D \preceq B + D. \]
If $D \succeq 0$, then $D$ is called an \defn{effective} divisor.

Divisors of a curve, together with this partial order, form a lattice --
every pair of divisors have a unique join and meet,
which we call their \defn{least common multiple} and \defn{greatest common divisor}.
Given two divisors $D$ and $D'$, their least common multiple is the unique, smallest divisor $L$
such that $D \preceq L$ and $D' \preceq L$.
Their greatest common divisor is the unique, largest divisor $G$ such that $G \preceq D$ and $G \preceq D'$.
Defined explicitly,
\begin{align*}
  \lcm(D, D') &= \sum_{P \in C(\bar K)}\max\{\ord_P(D), \ord_P(D')\}P \\
  \gcd(D, D') &= \sum_{P \in C(\bar K)}\min\{\ord_P(D), \ord_P(D')\}P.
\end{align*}
Just as integers $a$ and $b$ satisfy the law
  \[ \left| ab \right| = \lcm(a,b)\gcd(a,b), \]
divisors satisfy the law
  \[ D + D' = \lcm(D, D') + \gcd(D, D'). \]
This property will play a prominent role when adding divisors in Chapter \ref{chap_addition}.

There is a short chain of subgroups of $\Div(C)$,
\[ \Princ(D) \subset \Div_K^0(C) \subset \Div^0(C) \subset \Div(C), \]
which we will now describe.

Since $\deg : \Div(C) \to \bb Z$ is a group homomorphism, its kernel is a subgroup of $\Div(C)$.
The kernel, of course, is the subgroup of divisors of degree zero, which we denote by $\Div^0(C) := \ker \deg$.

Let $\sigma \in \Gal(\bar K / K)$.
In Chapter \ref{chap_curves}, we defined the action of $\sigma$ on a point (Equation \ref{eq_galois_action_on_point}).
This may be extended to an action on $\Div(C)$ in a natural way.
If $D = \sum n_P P$, then define
\[ \sigma(D) = \sum_{P \in C(\bar K)} n_P \sigma(P). \]
Just as $\sigma$ permutes points in $C(\bar K)$, so too does it permute divisors in $\Div(C)$.
In this way, an automorphism in $\Gal(\bar K/K)$ is also an automorphism of $\Div(C)$.

Given an automorphism $f$ on a group $G$, the \defn{fixed-point subgroup} of $f$ is
  \[ G^f := \{ g \in G ~|~ f(g) = g \}. \]
Given a set $S$ of automorphisms on $G$, this may be generalized even further:
  \[ G^S := \{ g \in G ~|~ \forall f \in S : f(g) = g \}. \]
So $G^S$ is the set of group elements in $G$ fixed by every automorphism in $S$.

We say that a divisor $D$ is \defn{defined over $K$} if $D$ is fixed by every automorphism in $\Gal(\bar K/K)$.
Divisors defined over $K$ therefore form a subgroup $\Div_K(C) \subset \Div(C)$.
  \[ \Div_K(C) := \Div(C)^{\Gal(\bar K/K)} \]

\begin{example}
  Let $K$ be any field, $L/K$ any algebraic extension and $\sigma \in \Gal(\bar K/L)$.
  By definition, $\sigma$ fixes $L$.
  If $P$ is any point with coordinates in $L$, then $\sigma(P) = P$.
  If $D$ is any divisor consisting only of points with coordinates in $L$, then $\sigma(D) = D$ and $D$ is defined over $L$.
\end{example}
\begin{example}
  \label{ex_not_defined_over_k}
  Let $K = \bb F_2$ and let $L = K(\alpha)$ be an algebraic extension with $\alpha^2 + \alpha = 1$.
  Let $C$ be the $C_{3,4}$ curve over $K$ defined by the polynomial $F = y^3 + x^4 + x + 1$.
  Let $P$ be the point $(\alpha : 1 : 1)$ on $C$ and let $D$ be the divisor $D = P$.
  There is an automorphism $\sigma \in \Gal(\bar K/K)$ that maps $\alpha \mapsto \alpha + 1$, and
    \[ \sigma(D) = \sigma(P) = (\sigma(\alpha) : \sigma(1) : \sigma(1)) = (\alpha + 1 : 1 : 1) \neq D. \]
  Hence $D$ is not defined over $K$.
\end{example}
\begin{example}
  \label{ex_defined_over_k}
  Let $K$, $L$, $C$, and $P$ be as in the previous example.
  Let $Q = (\alpha + 1 : 1 : 1)$, which is also a point on $C$.
  Let $D$ be the divisor $D = P + Q$.
  Every automorphism $\sigma$ in $\Gal(\bar K/K)$ maps $\alpha$ to itself or to $\alpha + 1$.
  Consequently, either
  \begin{itemize}
    \item $\sigma(P) = P$ and $\sigma(Q) = Q$, or
    \item $\sigma(P) = Q$ and $\sigma(Q) = P$.
  \end{itemize}
  In either case
  \[ \sigma(D) = \sigma(P) + \sigma(Q) = P + Q = D, \]
  So $D$ is defined over $K$.
\end{example}

The intersection of subgroups is again a subgroup, so define
  \[ \Div_K^0(C) := \Div_K(C) \cap \Div^0(C). \]
These are the divisors defined over $K$ of degree zero.

If $f \in K(C)$ is a rational function on $C$,
define the \defn{divisor of $f$} as
\[ \div(f) = \sum_{P \in C(\bar K)} \nu_P(f) P. \]
Recall that $\nu_P(f)$ was defined in Section \ref{sec_local_rings} for finite points $P$,
and at the end of Section \ref{sec_c34_curves} for $P_\infty$.
The divisor $\div(f)$ is the sum of the zeros of $f$ along $C$ minus its poles, counting multiplicity.
If $D = \div(f)$ for some rational function $C$,
then $D$ is called a \defn{principal divisor}.
\begin{proposition}
  Let $f \in K(C)$ be a rational function on $C$.
  Then $\div f \in \Div_K^0(C)$.
\end{proposition}
\begin{proof}
  By Theorem 7.7.1 in \cite{galbraith12}, $f$ has finitely many poles and zeroes, so that the formal sum
  \[ \div(f) = \sum_{P \in C(\bar K)} \nu_P(f) P \]
  is finite.
  By Theorem 8.3.14 in \cite{galbraith12}, $f$ has as many poles as it has zeroes, so that $\div(f)$ has degree zero.
  By Proposition \ref{prop_valuation_on_orbit}, $\div(f)$ is defined over $K$.
\end{proof}
Observe also that
\begin{align*}
  \div(f) + \div(g)
    &= \sum_{P \in C(\bar K)} \nu_P(f) P + \sum_{P \in C(\bar K)} \nu_P(g) P \\
    &= \sum_{P \in C(\bar K)} (\nu_P(f) + \nu_P(g))P \\
    &= \sum_{P \in C(\bar K)} \nu_P(fg)P \\
    &= \div(fg).
\end{align*}
We have also $\div(f) - \div(g) = \div(f/g)$,
so that principal divisors form a subgroup $\Princ(C) \subset \Div_K^0(C)$.
Finally, we have described the subsets
\[ \Princ(D) \subset \Div_K^0(C) \subset \Div^0(C) \subset \Div(C). \]

The \defn{divisor class group}\footnote{
Technically, the group of degree 0 divisor classes defined over $K$.
In some contexts, one may not demand that divisors by of degree 0 or defined over $K$,
construct analogous quotient groups, and refer to it as the divisor class group.}
of $C$ is the quotient group
\[ \Cl(C) = \frac {\Div_K^0(C)} {\Princ(C)}. \]
In the literature, the divisor class group is usually called the \defn{Jacobian}, $\Jac(C)$, of $C$,
e.g. \cite{arita05-2}, \cite{basiri04}, \cite{flon08}, \cite{harasawa00}, \cite{salem07}.
Other authors call it the divisor class group while giving it the notation $\Pic_K^0(C)$,
as it is isomorphic to the \defn{Picard group} of $C$,
e.g. \cite{eisenbud95} \cite{galbraith12} \cite{sutherland16}.
In this thesis, we will use the term divisor class group,
as the Picard group is usually defined in terms of line bundles
and the Jacobian implies a relationship to a Jacobian variety,
neither perspective being adopted here.

The \defn{affine part} or \defn{finite part} of a divisor $D$ is
\[ D_{\text{aff}} = \sum_{\substack{P \in C(\bar K) \\ P \neq P_\infty}} n_P P. \]
In the divisor class group, every divisor is equivalent to one whose finite part is effective.
To illustrate this, let $D$ be a divisor and suppose $\ord_P(D) = n < 0$ for some finite point $P = (x_0 : y_0 : 1)$.
Consider the vertical line through $P$.
This line is given by the polynomial $f = x - x_0$ and intersects $C$ at three points $P$, $Q$, and $R$,
not necessarily distinct, but counting multiplicity.
Then $\div f = P + Q + R - 3P_\infty$, and in the divisor class group, $\div f \equiv 0$.
Let $D' = D + n \div f$.
Then $D' \equiv D$ in the divisor class group and $\ord_P(D') \geq 0$.
At no finite point does $D'$ have lesser order than $D$.
Hence, we can repeatedly add principal divisors to a divisor $D$
to eliminate the points in $D$ with negative order,
resulting in an effective divisor equivalent to $D$.

Every divisor class therefore has a representative\footnote{
It may have many representatives of this form.
Reduced divisors, introduced in Chapter \ref{chap_representation},
are meant to be minimal unique representative of this form.}
of the form
  \[ D = P_1 + \ldots + P_n - nP_\infty, \]
where the $P_i$'s are finite points, but not necessarily distinct.
In other words, in the divisor class group,
every divisor $D$ may be written in the form (i.e. is equivalent to a divisor of the form)
  \[ D \equiv D_+ - D_\infty \]
where $D_+$ is an effective divisor and $D_\infty = \deg(D_+)P_\infty$ (also effective).
\begin{comment}
Unless otherwise specified, we will assume that a divisor $D$ is of this form.
Since $D_\infty$ is determined uniquely by $D^+$,
we will furthermore drop the $D_\infty$ part and denote $D$ by its positive part only.
That is, if $D = P + Q + R - 3P_\infty$, we will instead write simply $D = P + Q + R$ and call $D$ a degree 3 divisor.
\end{comment}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                    %%%%%
%%%%%   Prime Divisors   %%%%%
%%%%%                    %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Prime Divisors}
\label{sec_prime_divisors}

We have a partial order on divisors, with the property that $A \preceq B \implies \deg A \leq \deg B$.
On the subgroup $\Div_K^0(C)$, this partial order is uninteresting,
since there are no two distinct degree zero divisors with $A \preceq B$.

If $D$ is a degree zero divisor,
then we can separate out the point at infinity and write $D = D_{\text{aff}} - D_\infty$,
where $P_\infty \not\in \supp(D_{\text{aff}})$ and $D_\infty = (\deg D_{\text{aff}})P_\infty$.
The divisor $D_\infty$ is uniquely determined by the $D_{\text{aff}}$.
This leads to a more useful partial order on degree zero divisors.
For $A, B \in \Div_K^0(C)$, define the partial order $\leq$ by
  \[ A \leq B \iff A_{\text{aff}} \preceq B_{\text{aff}}. \]
Define also the set\footnote{
To clear up any possible confusion,
that's a $K$ and $\geq$ in $\Div_K^{\geq 0}(C)$, not a $\bar K$ and $>$.}
  \[ \Div_K^{\geq 0}(C) := \{ D \in \Div_K^0(C) ~|~ D \geq 0 \}. \]
The set $\Div_K^{\geq 0}(C)$ forms a monoid under addition,
and $(\Div_K^{\geq 0}(C), \leq)$ forms a lattice with a minimum element, 0.

With this partial order, we may define prime divisors in a manner that echoes
the definition of prime ideals\footnote{
A proper $R$-ideal $\frak p$ is prime if for all $R$-ideals $\frak a, \frak b$,
$\frak{ab} \subseteq \frak p \implies \frak a \subseteq \frak p \text{ or } \frak b \subseteq \frak p$.}
and Euclid's Lemma.\!\footnote{
An integer $p > 1$ is prime if for all $a,b \in \bb Z$, $p | ab \implies p | a \text{ or } p | b$.}
\begin{definition}
  A divisor $D \in \Div_K^{\geq 0}(C)$ is \defn{prime} if $D > 0$ and for all $A, B \in \Div_K^{\geq 0}(C)$,
  \[ D = A + B \implies D \leq A \text{ or } D \leq B. \]
\end{definition}
The prime divisors are the least non-zero divisors in the lattice $(\Div_K^{\geq 0}(C), \leq)$.
Another characterization of prime divisors is that they are orbits of points on $C$, which we will show now.
If $P \in C(\bar K)$ is a finite point, define
\[ [P] := \sum_{Q \in \orb(P)}(Q - P_\infty). \]
\begin{proposition}
  \label{prop_prime_divisors}
  Let $D \in \Div_K^0(C)$. The following are equivalent.
  \begin{enumerate}[label=(\roman*)]
    \item $D$ is prime;
    \item There is a finite point $P \in C(\bar K)$ such that $D = [P]$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  Let $D \in \Div_K^0(C)$.
  \begin{description}
    \item[(i) $\implies$ (ii):]
      Suppose $D$ is prime.
      Then $D > 0$, so let $P$ be a finite point in $\supp(D)$.
      Since $D$ is defined over $K$, every point in the orbit of $P$ is also in $\supp D$.
      So $[P] \leq D$, and $D = [P] + D'$ for some divisor $D' \in \Div_K^{\geq 0}(C)$.
      Since $D$ is prime, either $D \leq [P]$ or $D \leq D'$.
      Suppose $D \leq D'$.
      Then $D + [P] \leq D' + [P] = D$, hence $[P] \leq 0$, which is impossible.
      Therefore $D \leq [P]$.
      Since we have both $D \leq [P]$ and $[P] \leq D$, the result follows.
      
    \item[(ii) $\implies$ (i):]
      Suppose $D = [P]$ for some finite point $P$.
      Let $A, B \in \Div_K^{\geq 0}(C)$ be effective divisors such that $D = A + B$.
      Then $P \in \supp A$ or $P \in \supp B$.
      Suppose, without loss of generality, that $P \in \supp A$.
      Since $A$ is defined over $K$, every other point in $\orb P$ is in $\supp A$, hence $[P] \leq A$.
      Since $D = [P]$, $D \leq A$.
  \end{description}
\end{proof}

Just as non-zero ideals in a Dedekind domain can be uniquely factored into products of prime ideals,
non-zero divisors in $\Div_K^0(C)$ can be uniquely partitioned into sums of prime divisors.
This relationship is explored in the next chapter.
