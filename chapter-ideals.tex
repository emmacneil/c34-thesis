%%%%%%%%%%%%%%%%%%%%%%
%%%%%            %%%%%
%%%%%   Ideals   %%%%%
%%%%%            %%%%%
%%%%%%%%%%%%%%%%%%%%%%

\section{The Ideal Class Group}
\label{chap_ideals}

Performing arithmetic on divisors themselves is cumbersome.
Even if a divisor is defined over a field $K$,
the coordinates of its points may live in an algebraic extension $L/K$,
slowing down computations.

In this chapter, we shall see that the divisor class group of a curve
is isomorphic to the ideal class group of the curve's coordinate ring.
Every divisor may therefore be represented by polynomials over $K$,
rather than by points in $\bar K \times \bar K$.

We will demonstrate the existence of this isomorphism between the groups
by explicitly constructing an isomorphism and its inverse.
As the coordinate ring of a curve is a Dedekind domain,
we first describe how this isomorphism acts on non-zero prime ideals of $K[C]$.
We then extend this isomorphism to act on non-prime ideals, fractional ideals, and then ideal classes.



\subsection{Prime Ideals, Prime Divisors}

Let $\frak p$ be a non-zero prime ideal of $K[C]$.
Define the \defn{divisor of $\frak p$} to be
  \[ \div \frak p = \sum_{P \in C - P_\infty} \min_{f \in \frak p - \{0\}}\{\ord_P(f)\}(P - P_\infty). \]
The affine support of this divisor consists of those points at which \emph{every} polynomial in $\frak p$ is zero.
\note{(This is the affine variety $V(\frak p)$.)}
It is balanced by a negative multiple of the point at infinity,
so that, by construction, this divisor is of degree zero.
We will see that it is accurate to call such a divisor a \defn{prime divisor} --
this section will show that the divisors of prime ideals are exactly the prime divisors as defined in the previous chapter.

If $[P]$ is a prime divisor on $C$ as per the definition in Chapter \ref{chap_divisors}, then define
\[ I_{[P]} = \{ f \in K[C] ~|~ f(P) = 0 \}. \]
This is the set of polynomials in $K[C]$ that vanish on the support of $[P]$.
The following proposition shows that this set is in fact a prime (and therefore maximal) ideal.

\begin{proposition}
  \label{prop_I_P_is_prime}
  Let $P$ be an affine point on $C$ and let $\frak p = I_{[P]}$. Then
  \begin{enumerate}[label=(\roman*)]
    \item $\frak p$ is a $K[C]$-ideal;
    \item $\frak p$ is non-zero;
    \item $\frak p$ is prime;
    \item $\frak p$ is maximal;
    \item $\frak m_P = \frak p \cal O_P$;
  \end{enumerate}
\end{proposition}
\begin{proof}
  \begin{enumerate}[label=(\roman*)]
    \item
    Suppose $f, g \in \frak p$. Then
      \[ (f + g)(P) = f(P) + g(P) = 0 + 0 = 0, \]
    so $f + g \in \frak p$.
    Suppose $f \in \frak p$ and $h \in K[C]$. Then
      \[ (hf)(P) = h(P)f(P) = h(P)\cdot 0 = 0, \]
    so $hf \in \frak p$.
    
    \item
    Let $P = (x_0, y_0)$.
    Let $m(x) \in K[x]$ be the minimal polynomial of $x_0$.
    Let $\tilde m(x,y)$ be the image of $m$ in $K[C]$.
    Then $\tilde m$ is non-zero and $\tilde m(P) = \tilde m(x_0, y_0) = m(x_0) = 0$,
    so $\tilde m \in \frak p$.
    
    \item
    Suppose $fg \in \frak p$ for some $f, g \in K[C]$.
    Then $(fg)(P) = 0 = f(P)g(P)$.
    Since $f(P)$ and $g(P)$ are field elements, one of them must be zero.
    Therefore one of $f$ and $g$ is in $\frak p$.
    
    \item
    In a Dedekind domain, all non-zero prime ideals are maximal.
    
    \item
    \note{TODO. Is this fact even needed?}
  \end{enumerate}
\end{proof}

The next proposition gives another characterization of the ideal $I_{[P]}$
in terms of a prime ideal $\frak q$ of $\bar K[C]$ that ``lies over'' $I_{[P]}$.
\begin{proposition}
  Let $P = (x_0, y_0)$ be an affine point on $C$.
  Let $\frak q = \pid{x - x_0, y - y_0}$ as a $\bar K[C]$-ideal. Then
  \[ I_{[P]} = \frak q \cap K[C]. \]
\end{proposition}
\begin{proof}
  \begin{align*}
    I_{[P]}
      &= \pid{ f \in K[C] ~|~ f(P) = 0 } \\
      &= \pid{ f ~|~ f \in K[C], f(P) = 0 } \\
      &= \pid{ f ~|~ f \in K[C], f \in \frak q } \\
      &= \pid{ f ~|~ f \in K[C]} \cap \pid{ f ~|~ f \in \frak q } \\
      &= K[C] \cap \frak q.
  \end{align*}
\end{proof}
Intuitively, while $I_{[P]}$ is prime as a $K[C]$-ideal, it might be non-prime as a $\bar K[C]$-ideal.
In $\bar K[C]$, we may have that $I_{[P]}$ factors into a product $\prod \frak q_i$.
For any of those factors $\frak q_i$, we may restrict back down to $K[C]$, and we have $I_{[P]} = \frak q_i \cap K[C]$. 

We have now that $I_{[-]}$ defines map from prime divisors to prime ideals.
We show now that this map is one-to-one.
\begin{proposition}
  Let $P$ and $Q$ be affine points on $C$ and suppose $\orb(P) \neq \orb(Q)$.
  Then $I_{[P]} \neq I_{[Q]}$.
\end{proposition}
\begin{proof}
  Let $X$ and $Y$ be the sets
    \[ X = \{ x_i ~|~ (x_i, y_i) \in \orb(P) \} \triangle \{ x_i ~|~ (x_i, y_i) \in \orb(Q) \} \]
    \[ Y = \{ y_i ~|~ (x_i, y_i) \in \orb(P) \} \triangle \{ y_i ~|~ (x_i, y_i) \in \orb(Q) \}, \]
    where $\triangle$ denotes the symmetric difference of sets.
  So, e.g., $X$ is the set of $x$-coordinates found in the orbit of $P$ or $Q$, but not both.
  Suppose that $X$ is non-empty and contains an element $x_0$.
  Let $m(x_0)$ be the minimal polynomial of $x_0$, viewed as a polynomial in $K[C]$.
  Then $m$ is zero everywhere on the orbit of $P$, but is non-zero on the orbit of $Q$.
  Simlarly, if $Y$ contains an element $y_0$, then the minimal polynomial of $y_0$ gives the same result.

  Now suppose $X$ and $Y$ are both empty.
  Then there is a point $Q_0 \in \orb(Q)$ with the same $x$-coordinate as $P$, but whose $y$-coordinate is a conjugate of $P$'s.
  Without loss of generality, let $P = (x_1, y_1)$ and $Q_0 = (x_1, \sigma(y_1))$.
  Let $\frak q_1 = \pid{x - x_1, y - y_1}$ and $\frak q_2 = \pid{x - x_1, y - \sigma(y_1)}$. Then
  \begin{align*}
    I_{[P]} &= \frak q_1 \cap K[C] \\
    I_{[Q]} &= \frak q_2 \cap K[C],
  \end{align*}
  \[ \frak q_1 + \frak q_1 = \bar K[C], \]
  and
  \begin{align*}
    I_{[P]} + I_{[Q]}
      &= (\frak q_1 \cap K[C]) + (\frak q_2 \cap K[C]) \\
      &= (\frak q_1  + \frak q_1) \cap K[C] \\
      &= \bar K[C] \cap K[C] \\
      &= K[C] \neq I_{[P]}.
  \end{align*}
  Hence $I_{[P]} \neq I_{[Q]}$.
\end{proof}

\begin{corollary}
  Let $P$ and $Q$ be affine points on $C$. The following are equivalent:
  \begin{enumerate}[label=(\roman*)]
    \item $Q \in \orb(P)$;
    \item $\orb(P) = \orb(Q)$;
    \item $[P] = [Q]$;
    \item $I_{[P]} = I_{[Q]}$.
  \end{enumerate}
\end{corollary}
\begin{proof}
  \begin{description}
    \item [(i) $\implies$ (ii):]
      For some $\sigma \in \Gal(\bar K/K)$, we have $Q = \sigma(P)$ and $\sigma\inv(Q) = P$.
      
      Suppose $R \in \orb(P)$.
      Then $R = \phi(P)$ for some $\phi \in \Gal(\bar K/K)$ and
      \[ \sigma\phi\inv R = \sigma\phi\inv\phi(P) = \sigma(P) = Q \in \orb(Q). \]
      
      Suppose $R \in \orb(Q)$.
      Then $R = \phi(Q)$ for some $\phi \in \Gal(\bar K/K)$ and
      \[ \sigma\inv\phi\inv R = \sigma\inv\phi\inv\phi(Q) = \sigma\inv(Q) = P \in \orb(P). \]
    
    %\item [(ii) $\implies$ (i):]
    %  $Q \in \orb(Q)$ and $\orb(Q) = \orb(P)$, so $Q \in \orb(P)$.

    \item [(ii) $\implies$ (iv):]
      \begin{align*}
        I_{[P]}
          &= \pid{ f \in K[C] ~|~ f(P) = 0 } \\
          &= \pid{ f \in K[C] ~|~ \forall P_0 \in \orb(P) : f(P_0) = 0 } \\
          &= \pid{ f \in K[C] ~|~ \forall P_0 \in \orb(Q) : f(P_0) = 0 } \\
          &= \pid{ f \in K[C] ~|~ f(Q) = 0 } \\
          &= I_{[Q]}
      \end{align*}
      
    \item [(iv) $\implies$ (i):]
      By the previous proposition.
    
    \item [(ii) $\implies$ (iii):]
      By definition.

    \item [(iii) $\implies$ (ii):]
      \begin{align*}
        \sum_{P_0 \in \orb(P)}(P_0 - P_\infty) &= \sum_{Q_0 \in \orb(Q)}(Q_0 - P_\infty) \\
        \sum_{P_0 \in \orb(P)}P_0 &= \sum_{Q_0 \in \orb(Q)}Q_0 \\
        \{P_0 \in \orb(P)\} &= \{Q_0 \in \orb(Q)\} \\
        \orb(P) &= \orb(Q)
      \end{align*}
  \end{description}
\end{proof}

\begin{lemma}
  \label{lem_order_is_1}
  Let $P$ be an affine point on $C$ and let $\frak p = I_{[P]}$.
  Then $\ord_P(\div \frak p) = 1$.
\end{lemma}
\begin{proof}
  Clearly, $\ord_P(\div \frak p) \geq 1$.
  We must show that there is a polynomial in $\frak p$ whose valuation at $P$ is exactly 1.
  
  Let $P = (x_0, y_0)$ and consider the lines determined by $x - x_0$ and $y - y_0$.
  Since $C$ is non-singular, at most one of these lines is tangent to $C$ at $P$.
  Without loss of generality, suppose $x - x_0$ is not tangent to $C$ at $P$.
  Let $m(x, y)$ be the minimum polynomial of $x_0$, seen as an element of $K[C]$.
  Then $\nu_P(m) = \nu_P(x - x_0) = 1$.
  Moreover, $m(x, y)$ is zero on the orbit of $P$,
  so $m(x, y) \in I_{[P]} = \frak p$.
\end{proof}

\begin{proposition}
  \label{prop_prime_ideals_prime_divisors}
  Let $\frak p$ be a non-zero prime ideal and let $P$ be an affine point on $C$.
  The following are equivalent
  \begin{enumerate}[label=(\roman*)]
    \item $P \in \supp(\div \frak p)$;
    \item $\frak p = I_{[P]}$.
    \item $\div \frak p = [P]$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  \begin{description}
    \item [(i) $\implies$ (ii):]
      Suppose $P$ is in the support of $\div \frak p$.
      Then every polynomial in $\frak p$ is zero at $P$, so $\frak p \subseteq I_{[P]}$.
      By Proposition \ref{prop_I_P_is_prime}, $I_{[P]}$ is a prime ideal and therefore proper.
      Since $\frak p$ is prime, this implies $\frak p = I_{[P]}$.

    \item [(ii) $\implies$ (i):]
      Suppose $\frak p = I_{[P]}$.
      For every non-zero polynomial $f \in \frak p$, $f(P) = 0$, hence $\nu_P(f) > 0$.
      Now the order of $\div \frak p$ at $P$ is
      \[ \ord_P(\div \frak p) = \min_{0 \neq f \in \frak p}\{ \nu_P(f) \} > ,0 \]
      therefore $P \in \supp(\div \frak p)$.

    \item [(ii) $\implies$ (iii):]
      Suppose $\frak p = I_{[P]}$.
      Since $I_{[P]} = I_{[\sigma(P)]}$ for every $\sigma \in \Gal(\bar K/K)$,
      we have $\sigma(P) \in \supp(\div \frak p)$.
      That is, the entire orbit of $P$ is in the support of $\div \frak p$.
      Conversely, if $Q$ is not in the orbit of $P$, then $\frak p \neq I_{[Q]}$,
      so that $Q \not \in \supp(\div \frak p)$.
      By Lemma \ref{lem_order_is_1}, $P$ appears with multiplicity 1, so that $\div \frak p = [P]$.
      
    \item [(iii) $\implies$ (i):]
      \note{Obvious.}
  \end{description}
\end{proof}

Proposition \ref{prop_prime_ideals_prime_divisors} has two important consequences.
It shows that every prime ideal $\frak p$ of $K[C]$ is of the form $I_{[P]}$ for a prime divisor $[P]$.
It also shows that every prime divisor $[P]$ is of the form $\div \frak p$ for a prime ideal $\frak p$.
We end this section with the main result.
Prime ideals and prime divisors are in bijection via the maps $I_{(-)}$ and $\div(-)$, which are mutual inverses.

\begin{proposition}
  Let $P$ be an affine point in $C(\bar K)$ and let $\frak p$ be a non-zero prime ideal of $K[C]$. Then
  \begin{enumerate}[label=(\roman*)]
    \item $I_{\div \frak p} = \frak p$;
    \item $\div I_{[P]} = [P]$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  \begin{enumerate}[label=(\roman*)]
    \item
      Let $\frak p$ be a non-zero prime idea of $K[C]$.
      Then there is an affine point $P \in \supp(\div \frak p)$,
      and $\frak p = I_{[P]}$. Then
      \[ \div I_{[P]} = \div \frak p = [P]. \]
    
    \item
      Let $P$ be an affine point in $C(\bar K)$.
      Let $\frak p = I_{[P]}$. Then $\frak p$ is a non-zero prime ideal and
      \[ I_{\div \frak p} = I_{[P]} = \frak p. \]
  \end{enumerate}
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Ideals and Divisors}

The coordinate ring $K[C]$ is a Dedekind domain.
The non-zero ideals of $K[C]$ may be factored into a product of prime ideals, and this factorization is unique.
Our maps between prime ideals and prime divisors can now be extended to act on any non-zero ideal of $K[C]$ or any prime divisor of $\Div_K^0(C)$.

Let $\frak a$ be a non-zero ideal of $K[C]$.
Let its factorization into prime ideals be $\frak p_1^{k_1} \dots \frak p_n^{k_n}$.
Then define the divisor of $\frak a$ to be
\[ \div \frak a = \sum_{i=1}^n k_i \div \frak p_i. \]
The divisor of $\frak a$ is the sum of the divisors of its prime factors.
As for the whole ring $K[C]$ itself,
its prime factorization is the empty product which maps to the empty sum:
  \[ \div (K[C]) = 0. \]
Note that the divisor of $\frak a$ is of degree zero and defined over $K$.

In the other direction, denote by $\Div_K^{\geq 0}(C)$ the subset
  \[ \Div_K^{\geq 0} = \{ D \in \Div_K^0(C) ~|~ D \geq 0 \}. \]
Then $\Div_K^{\geq 0}(C)$ is a monoid under addition.
Let $D$ be a non-zero divisor in $\Div_K^{\geq 0}(C)$.
Then it factors into a sum of prime divisors, say $D = k_1[P_1] + \dots + k_n[P_n]$.
Define the ideal of $D$ to be
\[ I_D = \prod_{i=1}^n I_{[P_i]}^{k_i}. \]
The divisor 0 is the empty sum.
Let it map to the empty product, which is the whole ring $K[C]$:
\[ I_{0} = K[C]. \]

Let $\cal I_C$ be the monoid of non-zero ideals of $K[C]$.
We now have maps $\div(-) : \cal I_C \to \Div_K^0(C)$ and $I_{(-)} : \Div_K^0(C) \to \cal I_C$.
\begin{theorem}
  The maps $\div(-)$ and $I_{(-)}$ are isomorphisms of monoids and mutual inverses.
\end{theorem}
\begin{proof}
  Let $I \in \cal I_C$. Let its prime factorization be $\prod \frak p_i^{k^i}$. Then
  \begin{align*}
    I &= \prod_{i=1}^n \frak p_i^{k_i} \\
    \div I &= \sum_{i=1}^n k_i[P_i]
      & P_i \in \supp(\div \frak p_i) \\
    I_{\div I} &= \prod_{i=1}^n I_{[P_i]}^{k_i} \\
               &= \prod_{i=1}^n \frak p_i^{k_i} \\
               &= I.
  \end{align*}
  Let $D \in \Div_K^0(C)$. Let its prime factorization be $\sum k_i[P_i]$. Then
  \begin{align*}
    D &= \sum_{i=1}^n k_i[P_i] \\
    I_D &= \prod_{i=1}^n I_{[P_i]}^{k_i} \\
    \div(I_D) &= \sum_{i=1}^n k_i [P_i] \\ &= D.
  \end{align*}
\end{proof}
\begin{comment}
\begin{proof}
  The proof is quite immediate after factoring each ideal.
  It has already been established that $\div$ maps the identity $K[C]$ of $\cal I_C$ to the identity $0$ of $\Div_K^0(C)$.
  Let $\frak a$ and $\frak b$ be non-zero ideals with prime factorizations
  \[ \frak a = \prod \frak p_i^{k_i}, ~~~ \frak b = \prod \frak q_i^{\ell_i}. \]
  Then
  \begin{align*}
    \div (\frak a \frak b)
      &= \div \left( \left( \prod \frak p_i^{k_i} \right) \left( \prod \frak q_j^{\ell_j} \right) \right) \\
      &= \sum k_i \div \frak p_i + \sum \ell_j \div \frak q_i \\
      &= \div \frak a + \div \frak b.
  \end{align*}
\end{proof}
\end{comment}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Fractional Ideals and $\Div_K^0(C)$}

We may extend the maps even further to fractional ideals and the entirety of $\Div_K^0(C)$.

Let $\cal J_C$ denote the Abelian group of fractional ideals of $K[C]$.
Let $\frak a \in \cal J_C$.
Then $\frak a$ is of the form $\pid{\frac 1 f} \frak b$ for some polynomial $f \in K[C]$ and some integral ideal $\frak b$ of $K[C]$.
Define
\[ \div \frak a = \div \frak b - \div f. \]

Let $D \in \Div_K^0(C)$.
Then $D$ can be written in the form $D = A - \div(f)$ where $A \in \Div_K^{\geq 0}(C)$.
\note{(Maybe this should be a proposition in chapter \ref{chap_divisors}.)}
Define
\[ I_D = \pid{\frac 1 f} I_A \inv. \]
We show that these two maps are well-defined.

\begin{proposition}
  The map $\div(-) : \cal J_C \to \Div_K^0(C)$ is well defined.
\end{proposition}
\begin{proof}
  Suppose that $\frak a$ is a fractional ideal,
  $\frak b$ and $\frak c$ are integral ideals,
  $f$ and $g$ are non-zero polynomials, and
    \[ \frak a = \frac 1 f \frak b = \frac 1 g \frak c. \]
  Then $g \frak b = f \frak c$ are integral ideals and
  \begin{align*}
    g \frak b &= f \frak c \\
    \div(g \frak b) &= \div(f \frak c) \\
    \div(g) + \div \frak b &= \div(f) + \div \frak c \\
    \div \frak b - \div(f) &= \div \frak c - \div(g)
%    \div \left( \frac 1 f \frak b \right) &= \div \left( \frac 1 g \frak c \right)
  \end{align*}
\end{proof}

\begin{proposition}
  The map $I_{(-)} : \Div_K^0(C) \to \cal J_C$ is well defined.
\end{proposition}
\begin{proof}
  Suppose that $D, A, B \in \Div_K^0(C)$, $A, B \geq 0$,
  $f, g \in K[C]$ are non-zero, and
    \[ D = A - \div(f) = B - \div(g). \]
  Then
  \begin{align*}
    A + \div(g) &= B + \div(f) \\
    I_{A + \div(g)} &= I_{B + \div(f)} \\
    I_A I_{\div(g)} &= I_B I_{\div(f)} \\
    g I_A &= f I_B \\
    \frac 1 f I_A &= \frac 1 g I_B.
  \end{align*}
\end{proof}

\begin{proposition}
  The map $\div(-) : \cal J_C \to \Div_K^0(C)$ is a group homomorphism.
\end{proposition}
\begin{proof}
  Let $\frak a, \frak b$  be fractional ideals, and let
  \[ \frak a = \frac 1 f \frak a', ~~~ \frak b = \frac 1 g \frak b', \]
  where $\frak a'$ and $\frak b'$ are integral ideals. Then
  \begin{align*}
    \div(\frak a \frak b)
      &= \div \left( \frac 1 {fg} \frak a' \frak b' \right) \\
      &= \div(\frak a' \frak b') - \div (fg) \\
      &= \div \frak a' + \div \frak b' - \div f - \div g \\
      &= (\div \frak a' - \div f) + (\div \frak b' - \div g) \\
      &= \div \frak a + \div \frak b.
  \end{align*}
\end{proof}
\begin{proposition}
  The map $I_{(-)} : \Div_K^0(C) \to \cal J_C$ is a group homomorphism.
\end{proposition}
\begin{proof}
  Let $A, B \in \Div_K^0(C)$ and let
    \[ A = A' - \div f, ~~~ B = B' - \div g, \] 
  where $A', B' \geq 0$. Then
  \begin{align*}
    I_{A + B}
      &= I_{A' + B' - \div(fg)} \\
      &= \frac 1 {fg} I_{A' + B'} \\
      &= \frac 1 {fg} I_{A'}I_{B'} \\
      &= \left( \frac 1 f I_{A'} \right) \left( \frac 1 g I_{B'} \right) \\
      &= I_A I_B.
  \end{align*}
\end{proof}

\begin{theorem}
  The maps $\div(-) : \cal J_C \to \Div_K^0(C)$ and $I_{(-)} : \Div_K^0(C) \to \cal J_C$
  are group isomorphisms and mutual inverses.
\end{theorem}
\begin{proof}
  Let $\frak a$ be a fractional ideal with
  $\frak a = \frac 1 f \frak a'$,
  where $\frak a'$ is integral. Then
  \begin{align*}
    I_{\div \frak a}
      &= I_{\div \frak a' - \div f} \\
      &= \frac 1 f I_{\div \frak a'} \\
      &= \frac 1 f \frak a' \\
      &= \frak a.
  \end{align*}
  
  Let $D$ be a degree zero divisor defined over $K$ with
  $D = D' - \div f$, where $D' \geq 0$. Then
  \begin{align*}
    \div I_D
      &= \div \left( \frac 1 f I_{D'} \right) \\
      &= \div I_{D'} - \div f \\
      &= D' - \div f \\
      &= D.
  \end{align*}
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{The Ideal Class Group}

Let $\cal J_C$ be the group of fractional ideals of $K[C]$ and let $\cal P_C$ denote its subgroup of principal ideals.
The \defn{ideal class group} of $K[C]$ is
\[ \cal H_C = \frac {\cal J_C} {\cal P_C}. \]
Since $\cal J_C$ is isomorphic to $\Div_K^0(C)$ and $\cal P_C$ to $\Princ_K(C)$, we have
\[ \cal H_C \simeq \Cl_K^0(C). \]

In the ideal class group, two fractional ideals $\frak a$ and $\frak b$ are equivalent
if there is a rational function $\frac f g \in K(C)$ such that $\frak a = \frac f g \frak b$.
Under this relation, every fractional ideal is equivalent to an integral ideal.
Thus every ideal class has an integral representative.
In particular, given an ideal class $[\frak a]$, the inverse class $[\frak a\inv]$ has an integral representative.
For the rest of this section, we see how to use the ideal quotient to find an integral ideal $\frak b \equiv \frak a \inv$.

Let $\frak a$ and $\frak b$ be \emph{integral} ideals of a ring $R$.
The \defn{ideal quotient} of $\frak a$ by $\frak b$, also called the \defn{colon ideal}, is
\[ \frak a : \frak b = \{ r \in R ~|~ r \frak b \subseteq \frak a \}. \]
The following proposition sums up several useful, well-known properties of the colon ideal.
\begin{proposition}
  \label{prop_colon_ideal}
  Let $\frak a$, $\frak b$, and $\frak c$ be $R$-ideals. Then
  \begin{enumerate}[label=(\roman*)]
    \item $\frak a : \frak b$ is an $R$-ideal;
    \item $\frak a \subseteq \frak a : \frak b$;
    \item $\frak a : R = \frak a$;
    \item $R : \frak a = R$;
    \item $\frak a \frak b \subseteq \frak c \iff \frak a \subseteq \frak c : \frak b$;
    \item $\frak a : \frak b = R \iff \frak b \subseteq \frak a$;
    \item $\frak a : (\frak b + \frak c) = (\frak a : \frak b) \cap (\frak a : \frak c)$;
    \item $(\frak a \cap \frak b) : \frak c = (\frak a : \frak c) \cap (\frak b : \frak c)$;
    \item $(\frak a : \frak b) : \frak c = \frak a : \frak b \frak c$.
  \end{enumerate}
\end{proposition}
These properties are given as propositions in \cite{cox07},
though the statements are given for a multivariate polynomial ring over a field, $K[x_1, \ldots, x_n]$
rather than for an arbitrary \note{commutative} ring \note{with identity} $R$,
and most of the proofs are left as exercises.
\begin{proof}
  \begin{enumerate}[label=(\roman*)]
    \item Let $a, b \in \frak a : \frak b$.
          Then $aJ, bJ \subseteq I$.
          Then $(a + b)J = aJ + bJ \subseteq I$
          (since $aJ + bJ$ is the join of $aJ$ and $bJ$ in the lattice of $R$-ideals).
          So $a + b \in \frak a : \frak b$.
          
          Let $a \in \frak a : \frak b$, $r \in R$.
          Then $a \frak b \subseteq \frak a$ and $ra \frak b \subseteq a \frak b$,
          so $ra \frak b \subseteq \frak a$ and $ra \in \frak a : \frak b$.

    \item
      We have that
      \begin{align*}
             & \frak a \subseteq \frak a : b \\
        \iff & \forall a \in \frak a : a \frak b \subseteq \frak a \\
        \iff & \forall a \in \frak a : \forall b \in \frak b : ab \in \frak a.
      \end{align*}
      The last statement is true since ideals are closed under multiplication by $R$.
      
    \item
      By part (ii), we have $\frak a \subseteq \frak a : R$.
      Suppose $a \in \frak a : R$.
      Then $aR \subseteq \frak a$.
      In particular, $a = a \cdot 1_R \in \frak a$,
      so $\frak a : R \subseteq \frak a$.
      
    \item
      By definition, $R : \frak a \subseteq R$.
      By part (ii), $R \subseteq R : \frak a$.
      
    \item
      ($\implies$) Let $a \in \frak a$. Then $a \frak b \subseteq \frak a \frak b$,
      and by hypothesis, $\frak a \frak b \subseteq \frak c$,
      so $a \frak b \subseteq \frak c$,
      and $a \in \frak c : \frak b$.
      
      ($\impliedby$) Let $a \in \frak a$.
      By hypothersis, $a \in \frak c : \frak b$, so $a \frak b \subseteq \frak c$.
      Since the choice of $a$ was arbitrary, this means $\frak a \frak b \subseteq \frak c$.
      
    \item
      ($\implies$) Suppose $\frak a : \frak b = R$.
      Then $\frak b = 1_R \frak b \subseteq \frak a$.
      
      ($\impliedby$) Suppose $b \subseteq \frak a$.
      For all $r \in R$, $r \frak b \subseteq \frak b$.
      So $r \frak b \subseteq \frak a$ and $\frak a : \frak b = R$.
      
    \item
      Let $r \in R$. We have
      \begin{align*}
           & r(\frak b + \frak c) \subseteq \frak a \\
      \iff & r \frak b + r \frak c \subseteq \frak a \\
      \iff & r \frak b \subseteq \frak a \text{ and } r \frak c \subseteq \frak a.
      \end{align*}
      So
      \begin{align*}
        \frak a : (\frak b + \frak c)
          &= \{ r \in R ~|~ r(\frak b + \frak c) \subseteq \frak a \} \\
          &= \{ r \in R ~|~ r \frak b \subseteq \frak a \text{ and } r \frak c \subseteq \frak a \} \\
          &= \{ r \in R ~|~ r \frak b \subseteq \frak a \} \cap \{ r \in R ~|~ r \frak c \subseteq \frak a \} \\
          &= (\frak a : \frak b) \cap (\frak a : \frak c).
      \end{align*}
    
    \item
      Similarly to part (vii),
      \begin{align*}
        (\frak a \cap \frak b) : \frak c
          &= \{ r \in R ~|~ r \frak c \subseteq \frak a \cap \frak b \} \\
          &= \{ r \in R ~|~ r \frak c \subseteq \frak a \text{ and } r \frak c \subseteq \frak b \} \\
          &= \{ r \in R ~|~ r \frak c \subseteq \frak a \} \cap \{ r \in R ~|~ r \frak c \subseteq \frak b \} \\
          &= (\frak a : \frak c) \cap (\frak b : \frak c).
      \end{align*}
    
    \item
      Let $r \in R$. We have
      \begin{align*}
           & r \frak c \subseteq \frak a : \frak b \\
      \iff & r \frak b \frak c \subseteq \frak a & \text{by (v)} \\
      \iff & r \in \frak a : \frak b \frak c,
      \end{align*}
      so
      \begin{align*}
        (\frak a : \frak b) : \frak c
          &= \{ r \in R ~|~ r \frak c \subseteq \frak a : \frak b \} \\
          &= \{ r \in R ~|~ r \in \frak a : \frak b \frak c \} \\
          &= \frak a : \frak b \frak c.
      \end{align*}
  \end{enumerate}
\end{proof}

The following proposition and its corollary illustrate why this ideal might be called the ideal quotient.
In a Dedekind domain, we have $\frak a \frak b : \frak b = \frac {\frak a \frak b}{\frak b} = \frak a$.

\begin{proposition}
  \label{prop_colon_by_prime}
  Let $R$ be a Dedekind domain.
  Let $\frak a$ be a non-zero ideal and $\frak p$ a non-zero prime ideal of $R$. Then
  \[ \frak a \frak p : \frak p = \frak a. \]
\end{proposition}
\begin{proof}
  Clearly, $\frak a \frak p \subseteq \frak a \frak p$.
  Using Proposition \ref{prop_colon_ideal}.(v),
  this gives $\frak a \subseteq \frak a \frak p : \frak p$.
  
  Suppose $\alpha \in \frak a \frak p : \frak p$.
  Then $(\alpha)\frak p \subseteq \frak a \frak p$
  and there exists a non-zero ideal $\frak b$ such that $(\alpha)\frak p = \frak a \frak b \frak p$.
  By \note{Conrad\footnote{{\tt https://kconrad.math.uconn.edu/blurbs/gradnumthy/idealfactor.pdf}} Corollary 3.3}, $(\alpha) = \frak a \frak b$,
  so $(\alpha) \subseteq \frak a$ and $\alpha \in \frak a$.
\end{proof}

\begin{corollary}
  \label{cor_ab_colon_b_is_a}
  Let $R$ be a Dedekind domain.
  Let $\frak a$ and $\frak b$ be non-zero ideals of $R$. Then
  \[ \frak a \frak b : \frak b = \frak a. \]
\end{corollary}
\begin{proof}
  Let $\frak b$ factor into $\frak p_1 \cdots \frak p_n$, where the $\frak p_i$'s are not necessarily distinct.
  Then
  \begin{align*}
    \frak a \frak b : \frak b
      &= (\frak a \frak p_1 \frak p_2 \dots \frak p_n) : (\frak p_1 \frak p_2 \dots \frak p_n) \\
      &= (((\frak a \frak p_1 \frak p_2 \dots \frak p_n : \frak p_1) : \frak p_2) : \dots) : \frak p_n
        & \text{by Prop \ref{prop_colon_ideal}.ix} \\
      &= ((\frak a \frak p_2 \dots \frak p_n : \frak p_2) : \dots) : \frak p_n
        & \text{by Prop \ref{prop_colon_by_prime}} \\
      &= \dots & \text{induction} \\
      &= \frak a.
  \end{align*}
\end{proof}

The above corollary allows us to invert and ideal class and find an integral representative.
This is made explicit in the next corollary.

\begin{corollary}
  Let $\frak a$ be a non-zero ideal of $K[C]$,
  and $[\frak a]$ its image in the ideal class group.
  Let $\alpha \in \frak a$. Then
  \[ [\frak a]\inv = [\alpha : \frak a]. \]
\end{corollary}
\begin{proof}
  By Corollary \ref{cor_ab_colon_b_is_a},
  \[ \frak a(\alpha : \frak a) = (\alpha) \]
  as ideals.
  In the ideal class group,
  \[ [\frak a][\alpha : \frak a] = [\alpha] = [1], \]
  so that $\frak a$ and $\alpha : \frak a$ are inverses of one another.
\end{proof}

Since the divisor and ideal class groups are isomorphic, and every ideal class has an integral representative,
we may now represent divisor classes by integral ideals, i.e. ideals generated by polynomials.
There is no need to work with fractional ideals and rational functions.
In the next chapter, we discuss this representation by polynomial in greater detail.
