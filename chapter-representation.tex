%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                    %%%%%
%%%%%   Representation   %%%%%
%%%%%                    %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Representation}
\label{chap_representation}

In this chapter, we discuss representation of divisors.
A divisor is represented by an ideal, in turn represented by a Gr\"obner basis,
in turn represented by lists or arrays of coefficients.
These bases come in many forms.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                   %%%%%
%%%%%   Divisor Types   %%%%%
%%%%%                   %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Divisor Types}

In \cite{arita05-2}, the author classifies divisors into 19 types
based on the forms of the Gr\"obner bases of their ideals.
This classification is reproduced in the table below,
along with a 20th type representing the divisor 0.

\begin{center}
\begin{tabular}{l|l|l||l|l|l}
  %Degree & Type & Basis & Degree & Type & Basis \\
  D. & T. & Gr\"obner Basis & D. & T. & Gr\"obner Basis \\
  \hline
  0 & 0 & $1$ & \multirow{9}{*}{5} &\multirow{3}{*}{51} & $y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0$, \\
  \cline{1-3}
  \multirow{2}{*}{1} &\multirow{2}{*}{11} & $x + f_0$ & & & $x^3 + g_4xy + g_3x^2 + g_2y + g_1x + g_0$, \\
    & & $y + g_0$ & & & $x^2y + h_4xy + h_3x^2 + h_2y + h_1x + h_0$ \\
  \cline{1-3}\cline{5-6}
  \multirow{4}{*}{2} &\multirow{2}{*}{21} & $y + f_1x + f_0$, & & \multirow{2}{*}{52} & $xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    & & $x^2 + g_1x + g_0$ & & & $y^2 + g_3x^2 + g_2y + g_1x + g_0$ \\
    \cline{2-3}\cline{5-6}
    &\multirow{2}{*}{22}  & $x + f_0$, & & \multirow{2}{*}{53} & $xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    & & $y^2 + g_2y + g_0$ & & & $x^3 + g_5y^2 + g_3x^2 + g_2y + g_1x + g_0$ \\
  \cline{1-3}\cline{5-6}
  \multirow{6}{*}{3} &\multirow{3}{*}{31} & $x^2 + f_2y + f_1x + f_0$, & & \multirow{2}{*}{54} & $x^2 + f_2y + f_1x + f_0$, \\
    & & $xy + g_2y + g_1x + g_0$, & & & $xy^2 + g_5y^2 + g_4xy + g_2y + g_1x + g_0$ \\
  \cline{4-6}
    & & $y^2 + h_2y + h_1x + h_0$ & \multirow{10}{*}{6} &\multirow{3}{*}{61} & $x^3 + f_5y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    \cline{2-3}
    &\multirow{2}{*}{32} & $y + f_1x + f_0$, & & & $x^2y + g_5y^2 + g_4xy + g_3x^2 + g_2y + g_1x + g_0$, \\
    & & $x^3 + g_3x^2 + g_1x + g_0$ & & & $xy^2 + h_5y^2 + h_4xy + h_3x^2 + h_2y + h_1x + h_0$ \\
    \cline{2-3}\cline{5-6}
    &\multirow{1}{*}{33} & $x + f_0$ & &\multirow{2}{*}{62} & $y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0$, \\
  \cline{1-3}
  \multirow{8}{*}{4} &\multirow{3}{*}{41} & $xy + f_3x^2 + f_2y + f_1x + f_0$, & & & $x^3 + g_4xy + g_3x^2 + g_2y + g_1x + g_0$ \\
  \cline{5-6}
    & & $y^2 + g_3x^2 + g_2y + g_1x + g_0$, & &\multirow{2}{*}{63} & $y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    & & $x^3 + h_3x^2 + h_2y + h_1x + h_0$ & & & $x^2y + g_6x^3 + g_4xy + g_3x^2 + g_2y + g_1x + g_0$ \\
    \cline{2-3}\cline{5-6}
    &\multirow{2}{*}{42} & $x^2 + f_1x + f_0$, & &\multirow{2}{*}{64} & $xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    & & $xy + g_2y + g_1x + g_0$ & & & $x^4 + g_6x^3 + g_5y^2 + g_3x^2 + g_2y + g_1x + g_0$ \\
    \cline{2-3}\cline{5-6}
    &\multirow{2}{*}{43} & $x^2 + f_2y + f_1x + f_0$, & &\multirow{1}{*}{65} & $x^2 + f_2y + f_1x + f_0$ \\
    \cline{4-6}
    & & $y^2 + g_4xy + g_2y + g_1x + g_0$ \\
    \cline{2-3}
    &\multirow{1}{*}{44}
      & $y + f_1x + f_0$
\end{tabular}
\end{center}

So, for example, divisors of degree 2 come in two varieties: type 21 and type 22.
If $D$ is a type 21 divisor,
then $I_D$ is generated by a Gr\"obner basis of the form $\pid{y + f_1x + f_0, x^2 + g_1x + g_0}$.
If $D$ is instead a type 22 divisor,
then $I_D$ is generated by a Gr\"obner basis of the form $\pid{x + f_0, y^2 + g_2y + g_0}$.

The type 42 divisor in this table differs slightly from the type 42 divisor in \ref{arita05-2}.
In \ref{arita05-2}, a type 42 divisor has a generator of the form $x^2 + a_3y + a_2x + a_1$,
though in the table above, the coefficient of $y$ is assumed to be 0.
One can show that were the coefficient of $y$ non-zero, the divisor would be of type 31 instead.
This will be made clear below.

This table hides the fact that there are many dependencies between the coefficients.
For instance, a type 31 divisor has degree 3, and is therefore determined by 3 points, or 3 $(x,y)$-pairs.
So 6 numbers should be enough to represent a type 31 divisor, though the Gr\"obner basis has 9 coefficients.
One can show that, typically, $h_0, h_1, h_2$ depend on $f_0, \ldots, g_2$. E.g., \note{Insert equation here}.

Moreover, we will see that type 22 divisors are in bijection with type 11 divisors.
Intuitively, 3 coefficients is more than ought to be needed to represent it,
and there must be some dependencies between the coefficients.
\note{Maybe.}



%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                %%%%%
%%%%%   Operations   %%%%%
%%%%%                %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Operations}

Chapter \ref{chap_ideals} established the correspondence between divisors and ideals.
Addition of divisors is equivalent to multiplication of ideals.
What's more, for divisors $A, B$, $A \leq B \iff I_B \subseteq I_A$.
Divisors form a lattice $(\Div_K^{\geq 0}(C), \leq)$, as do ideals $(\cal I_C, \subseteq)$.
The map between the two is order-reversing.
The meet of two divisors (their $\gcd$) corresponds to the join of two ideals (their ideal sum).
The join of two divisors (their $\lcm$) corresponds to the meet of two ideals (their ideal intersection).
We have the following equivalences of operations.
\begin{center}
  \begin{tabular}{c|c}
    Divisors & Ideals \\
    \hline
    $A + B$ & $I_A I_B$ \\
    $\lcm(A,B)$ & $I_A \cap I_B$ \\
    $\gcd(A,B)$ & $I_A + I_B$ \\
    $\bar A$ & $f : I_A$
  \end{tabular}
\end{center}
where $f$ is ``minimal'' in $I_A$.
This last operation we define now.



\subsection{The Flip Operation}

If $D$ is a divisor and $I_D$ its ideal,
then there is a unique monic polynomial that is minimal with respect to the monomial order on $K[C]$.
When $I_D$'s unique reduced Gr\"obner basis is known,
this minimal element is merely the first of the Gr\"obner basis generators.

Let $f$ be the minimal element of $I_D$.
By Corollary \ref{cor_integral_ideal_inverse}, $f : I_D \equiv I_D\inv$.
Now define the \defn{flip of $D$} to be
  \[ \bar D := \div(f : I_D). \]
Then $\bar D \equiv -D$.

Of course, one may choose some non-minimal $g \in I_D$ and compute $\div(g : I_D)$ to get some other
divisor equivalent to $-D$.
Once we have defined what a reduced divisor is, we can show that, if $f$ is chosen to be minimal in $I_D$,
then $\bar D$ is reduced.

\note{Add geometric interpretation of flipping, with pictures.}



\subsection{Reduced Divisors}

\begin{definition}
  \label{def_reduced_divisor}
  Let $D \geq 0$ be a divisor in $\Div_K^0(C)$.
  Then $D$ is called \defn{reduced} if $\bar{\bar D} = D$.
\end{definition}

\begin{proposition}
  Let $A, B \in \Div_K^{\geq 0}(C)$.
  \begin{enumerate}[label=(\roman*)]
    \item $\bar A \equiv -A$;
    \item $\bar{\bar A} \equiv A$;
    \item $A \equiv B \iff \bar A = \bar D$;
    \item $\bar{\bar{\bar A}} = \bar A$;
    \item $\bar A$ is reduced.
  \end{enumerate}
\end{proposition}
\begin{proof}
  \begin{enumerate}[label=(\roman*)]
    \item 
    \item Immediate by part (i).
    \item
      ($\implies$)
      Suppose $A \equiv B$.
      Then in the ideal class group, $I_A \equiv I_B$,
      so that there are polynomials $f, g \in K[C]$ such that $gI_A = fI_B$.
      Without loss of generality, we may assume $f$ and $g$ are monic.
      Let $a$ and $b$ be the minimal polynomials in $I_A$ and $I_B$, respectively.
      Then the minimum polynomials in $gI_A$ and $fI_B$ are $ga$ and $fb$, respectively.
      Since $gI_A = fI_B$, we have $ga = fb$.
      
      Suppose $h \in a : I_A$. Then
      \begin{align*}
        hI_A &\subseteq \pid a \\
        hgI_A &\subseteq \pid{ga} \\
        hfI_B &\subseteq \pid{fb} \\
        hI_B &\subseteq \pid b,
      \end{align*}
      so $h \in b : I_B$.
      Likewise, if $h \in b : I_B$, then $h \in a : I_A$.
      Hence $a : I_A = b : I_B$ and $\bar A = \bar B$.
      
      ($\impliedby$)
      If $\bar A = \bar B$, then
      \[ A \equiv - \bar A = - \bar B \equiv B. \]
    \item By part (ii), $\bar{\bar A} \equiv A$.
          By part (iii), $\bar{\bar{\bar A}} = \bar A$.
    \item After part (iv), immediate by Definition \ref{def_reduced_divisor}.
  \end{enumerate}
\end{proof}

This proposition shows that if we flip a divisor $D$, we get a \emph{reduced} divisor equivalent to $-D$.
By flipping $D$ twice, we obtain a \emph{reduced} divisor equivalent to $D$ itself.
To reduce a divisor, we may flip it twice.

If $D$ is a divisor, then the degree and type of $\bar D$ is determined by the type of $D$.
We may use the formula
\begin{equation}
  \label{eq_flip_degree}
  \deg \bar D = \deg \div f - \deg D,
\end{equation}
where $f$ is the minimal polynomial in $I_D$ and is determined by the type of $D$.
\begin{example}
  Suppose $D$ is a type 51 divisor.
  Then the minimal polynomial of $I_D$ is of the form
  \[ y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0, \]
  and
  \[ \bar D \simeq f : I_D \simeq \div f - D. \]
  So
  \[ \deg \bar D = \deg \div f - \deg D = 8 - 5 = 3. \]
\end{example}

\begin{center}
  \begin{tabular}{r|cccccccccc}
    $\type(D)$    & 0 & 11 & 21 & 22 & 31 & 32 & 33 & 41 & 42 & 43 \\
    \hline
    $\deg \bar D$ & 0 & 2  & 2  & 1  & 3  & 1  & 0  & 3  & 2  & 2
  \end{tabular}
    
  \begin{tabular}{r|cccccccccc}
    $\type(D)$    & 44 & 51 & 52 & 53 & 54 & 61 & 62 & 63 & 64 & 65 \\
    \hline 
    $\deg \bar D$ & 0  & 3  & 2  & 2  & 1  & 3  & 2  & 2  & 1  & 0
  \end{tabular}
\end{center}

\begin{comment}
Not only is the degree of $\bar D$ determined by the type of $D$, but so too is the type of $\bar D$.
\begin{example}
  Let $D$ be a type 11 divisor.
  Then the minimal polynomial of $I_D$ is of the form $f = x + f_0$,
  and $\deg \bar D = \deg \div f - \deg D = 3 - 1 = 2$.
  So $\bar D$ is of type 21 or 22.
  However, $f \in f : I_D = I_{\bar D}$,
  so $\LT(f) = x \in \LT(I_{\bar D})$.
  Now $\bar D$ cannot be of type 21, because $x \not\in \pid{y, x^2}$.
  so $\bar D$ must be of type 22.
\end{example}
\end{comment}

Every reduced divisor is of degree 3 or less.
We can now determine exactly which types correspond to reduced divisors.

\begin{theorem}
  A divisor is reduced if and only if it is of type 0, 11, 21, 22, or 31.
\end{theorem}
\begin{proof}
  Using Equation \ref{eq_flip_degree}, we may immediately de
\end{proof}

If $D$ is a divisor, then the type of $\bar D$ is determined by the type of $D$.


\begin{itemize}
  \item How to determine type of $\bar D$.
  \item Definition of reduced divisor
  \item Types 0, 11, 21, 22, 31 reduced
\end{itemize}



\subsection{Typical Divisors}

\begin{itemize}
  \item Oyono's definition
  \item Kamal's definition
  \item Comparison to Arita
  \item Type *1 can typically be represented by first two polys.
\end{itemize}



\subsection{Geometric Interpretation}

\begin{itemize}
  \item Type 0 : nothing 
  \item Type 11 : a single rational affine point
  \item Type 21 : two points with distinct x-coordinates or a double point with non-vertical tangent line
  \item Type 22 : two points with same x-coordinates or a double point with vertical tangent line
  \item Type 31 : three distinct non-colinear points. Non-distinct : no straight line passes through the points with correct multiplicity
  \item Type 32 : three colinear points, distinct x-coordinates. Or non-distinct points interpolated by a non-vertical line
  \item Type 33 : three colinear points, same x-coordinates, or non-distinct points interpolated by vertical line.
\end{itemize}



\subsection{Type 31 Divisors}

\begin{itemize}
  \item
\end{itemize}



\subsection{Type 61 Divisors}

\begin{itemize}
  \item
\end{itemize}



\subsection{Figure out how to organize this}

\begin{lemma}
  Let $D$ be a divisor with ideal $I_D$.
  Fix $b \in \bb N$.
  There is a minimal non-zero monic polynomial in the set $\{ f \in I_D ~|~ y^b \text{ divides } \LT(f)\}$.
\end{lemma}
This polynomial is minimal in the sense that, if $g$ is any other polynomial such that $y^b|\LT(g)$,
then $\LT(f)|\LT(g)$.
This polynomial $f$ is not necessarily unique.
\begin{proof}
  Follows from a monomial order being a well-order.
\end{proof}

\begin{lemma}
  Let $D$ be a divisor with ideal $I_D$.
  There exist polynomials $f, g, h$ such that $I_D = \pid{f, g, h}$,
  $\LT(f) = x^c$,
  $\LT(g) = x^by$,
  $\LT(h) = x^ay^2$,
  $f$, $g$, and $h$ are minimal in the sense of the previous lemma,
  and $a \leq b \leq c$.
\end{lemma}
\begin{proof}
  Everything but the relation $a \leq b \leq c$ is immediate from the previous lemma.
  To prove this relation holds, suppose $b < a$.
  Then $y^2$ divides $\LT(gy)$ and $\LT(gy)$ divides $\LT(h)$, but $\LT(h)$ does not divide $\LT(gy)$,
  so $h$ was not minimal. Hence $a \leq b$.
  The same argument can be used to show $b \leq c$.
\end{proof}

\begin{lemma}
  Let $D$ be a divisor with ideal $I_D$.
  Let $I_D = \pid{f, g, h}$ as in the previous lemma.
  Then $\pid{f, g, h}$ is a (not necessarily reduced) Gr\"obner basis for $I_D$.
\end{lemma}
\begin{proof}
  \note{TODO???}
\end{proof}

\begin{lemma}
  Let $D$ be a divisor with ideal $I_D$.
  Let $I_D = \pid{f, g, h}$ as in the previous lemma.
  Then $a + b + c = \deg D$.
\end{lemma}
\begin{proof}
  We have that
  \[ \deg D = \dim \frac {K[C]}{I_D} = \dim \frac {K[C]}{\pid{f,g,h}}
%            = \dim \frac {K[C]}{\pid{x^c + \ldots, x^by + \ldots, x^ay^2 + \ldots}}
            = \dim \frac {K[C]}{\pid{x^c, x^by, x^ay^2}}. \]
  \note{And this is equal to $a + b + c$.}
\end{proof}

\begin{theorem}
  Let $D$ be a divisor with ideal $I_D$.
  Let $f$ be minimal in $I_D$. Then
  \[ -\nu_{P_\infty}(f) - \deg D \leq 3. \]
\end{theorem}
\begin{proof}
  Let $I_D = \pid{f, g, h}$ as in the previous lemma.
  The minimal polynomial of $I_D$ is either $f$, $g$, or $h$.
  Consider each case separately.
  \begin{description}
    \item[$f$ is minimal in $I_D$:]
      Then $\nu_{P_\infty}(f)$ is less than both $\nu_{P_\infty}(g)$ and $\nu_{P_\infty}(h)$.
      So $3c \leq 3b + 4$ and $3c \leq 3a + 8$, which implies
      $c - b \leq 1$ and $c - a \leq 2$. Then
      \begin{align*}
        -\nu_{P_\infty}(f) - \deg D
          &= 3c - (a + b + c) \\
          &= (c - a) + (c - b) \\
          &\leq 2 + 1 = 3.
      \end{align*}
      
    \item[$g$ is minimal in $I_D$:]
      Then $3b + 4 < 3c$ and $3b + 4 < 3a + 8$,
      which implies $b - c \leq -2$ and $b - a \leq 1$, so
      \begin{align*}
        -\nu_{P_\infty}(f) - \deg D
          &= 3b + 4 - (a + b + c) \\
          &= 4 + (b - a) + (b - c) \\
          &\leq 4 + 1 - 2 = 3.
      \end{align*}

    \item[$h$ is minimal in $I_D$:]
      Then $3a + 8 < 3c$ and $3a + 8 < 3b + 4$,
      which implies $a - c \leq -3$ and $a - b \leq -2$, so
      \begin{align*}
        -\nu_{P_\infty}(f) - \deg D
          &= 3a + 8 - (a + b + c) \\
          &= 8 + (a - b) + (a - c) \\
          &\leq 8 - 2 - 3 = 3.
      \end{align*}
  \end{description}
\end{proof}

\begin{theorem}
  Every reduced divisor on $C$ has degree at most 3.
\end{theorem}
\begin{proof}
  By the previous theorem, for any divisor $D$, $\bar D$ has degree at most 3, since
  \[ \deg \bar D = -\nu_{P_\infty}(f) - \deg D \leq 3. \]
  If $D$ is reduced, then $D$ is the flip of $\bar D$.
  Therefore $D$ has degree at most 3.
\end{proof}
