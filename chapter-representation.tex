%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                    %%%%%
%%%%%   Representation   %%%%%
%%%%%                    %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Representation}
\label{chap_representation}

In this chapter, we discuss representation of divisors.
A divisor is represented by an ideal, in turn represented by a Gr\"obner basis,
in turn represented by lists or arrays of coefficients.
These bases come in many forms.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                   %%%%%
%%%%%   Divisor Types   %%%%%
%%%%%                   %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Divisor Types}

In \cite{arita05-2}, the author classifies divisors into 19 types
based on the forms of the Gr\"obner bases of their ideals.
This classification is reproduced in the table below,
along with a 20th type representing the divisor 0.

\begin{center}
\begin{tabular}{l|l|l||l|l|l}
  %Degree & Type & Basis & Degree & Type & Basis \\
  D. & T. & Gr\"obner Basis & D. & T. & Gr\"obner Basis \\
  \hline
  0 & 0 & $1$ & \multirow{9}{*}{5} &\multirow{3}{*}{51} & $y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0$, \\
  \cline{1-3}
  \multirow{2}{*}{1} &\multirow{2}{*}{11} & $x + f_0$ & & & $x^3 + g_4xy + g_3x^2 + g_2y + g_1x + g_0$, \\
    & & $y + g_0$ & & & $x^2y + h_4xy + h_3x^2 + h_2y + h_1x + h_0$ \\
  \cline{1-3}\cline{5-6}
  \multirow{4}{*}{2} &\multirow{2}{*}{21} & $y + f_1x + f_0$, & & \multirow{2}{*}{52} & $xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    & & $x^2 + g_1x + g_0$ & & & $y^2 + g_3x^2 + g_2y + g_1x + g_0$ \\
    \cline{2-3}\cline{5-6}
    &\multirow{2}{*}{22}  & $x + f_0$, & & \multirow{2}{*}{53} & $xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    & & $y^2 + g_2y + g_0$ & & & $x^3 + g_5y^2 + g_3x^2 + g_2y + g_1x + g_0$ \\
  \cline{1-3}\cline{5-6}
  \multirow{6}{*}{3} &\multirow{3}{*}{31} & $x^2 + f_2y + f_1x + f_0$, & & \multirow{2}{*}{54} & $x^2 + f_2y + f_1x + f_0$, \\
    & & $xy + g_2y + g_1x + g_0$, & & & $xy^2 + g_5y^2 + g_4xy + g_2y + g_1x + g_0$ \\
  \cline{4-6}
    & & $y^2 + h_2y + h_1x + h_0$ & \multirow{10}{*}{6} &\multirow{3}{*}{61} & $x^3 + f_5y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    \cline{2-3}
    &\multirow{2}{*}{32} & $y + f_1x + f_0$, & & & $x^2y + g_5y^2 + g_4xy + g_3x^2 + g_2y + g_1x + g_0$, \\
    & & $x^3 + g_3x^2 + g_1x + g_0$ & & & $xy^2 + h_5y^2 + h_4xy + h_3x^2 + h_2y + h_1x + h_0$ \\
    \cline{2-3}\cline{5-6}
    &\multirow{1}{*}{33} & $x + f_0$ & &\multirow{2}{*}{62} & $y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0$, \\
  \cline{1-3}
  \multirow{8}{*}{4} &\multirow{3}{*}{41} & $xy + f_3x^2 + f_2y + f_1x + f_0$, & & & $x^3 + g_4xy + g_3x^2 + g_2y + g_1x + g_0$ \\
  \cline{5-6}
    & & $y^2 + g_3x^2 + g_2y + g_1x + g_0$, & &\multirow{2}{*}{63} & $y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    & & $x^3 + h_3x^2 + h_2y + h_1x + h_0$ & & & $x^2y + g_6x^3 + g_4xy + g_3x^2 + g_2y + g_1x + g_0$ \\
    \cline{2-3}\cline{5-6}
    &\multirow{2}{*}{42} & $x^2 + f_1x + f_0$, & &\multirow{2}{*}{64} & $xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    & & $xy + g_2y + g_1x + g_0$ & & & $x^4 + g_6x^3 + g_5y^2 + g_3x^2 + g_2y + g_1x + g_0$ \\
    \cline{2-3}\cline{5-6}
    &\multirow{2}{*}{43} & $x^2 + f_2y + f_1x + f_0$, & &\multirow{1}{*}{65} & $x^2 + f_2y + f_1x + f_0$ \\
    \cline{4-6}
    & & $y^2 + g_4xy + g_2y + g_1x + g_0$ \\
    \cline{2-3}
    &\multirow{1}{*}{44}
      & $y + f_1x + f_0$
\end{tabular}
\end{center}

So, for example, divisors of degree 2 come in two varieties: type 21 and type 22.
If $D$ is a type 21 divisor,
then $I_D$ is generated by a Gr\"obner basis of the form $\pid{y + f_1x + f_0, x^2 + g_1x + g_0}$.
If $D$ is instead a type 22 divisor,
then $I_D$ is generated by a Gr\"obner basis of the form $\pid{x + f_0, y^2 + g_2y + g_0}$.

The type 42 divisor in this table differs slightly from the type 42 divisor in \ref{arita05-2}.
In \ref{arita05-2}, a type 42 divisor has a generator of the form $x^2 + a_3y + a_2x + a_1$,
though in the table above, the coefficient of $y$ is assumed to be 0.
One can show that were the coefficient of $y$ non-zero, the divisor would be of type 31 instead.
This will be made clear below.

This table hides the fact that there are many dependencies between the coefficients.
For instance, a type 31 divisor has degree 3, and is therefore determined by 3 points, or 3 $(x,y)$-pairs.
So 6 numbers should be enough to represent a type 31 divisor, though the Gr\"obner basis has 9 coefficients.
One can show that, typically, $h_0, h_1, h_2$ depend on $f_0, \ldots, g_2$. E.g., \note{Insert equation here}.

Moreover, we will see that type 22 divisors are in bijection with type 11 divisors.
Intuitively, 3 coefficients is more than ought to be needed to represent it,
and there must be some dependencies between the coefficients.
\note{Maybe.}



%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                %%%%%
%%%%%   Operations   %%%%%
%%%%%                %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Operations}

Chapter \ref{chap_ideals} established the correspondence between divisors and ideals.
Addition of divisors is equivalent to multiplication of ideals.
What's more, for divisors $A, B$, $A \leq B \iff I_B \subseteq I_A$.
Divisors form a lattice $(\Div_K^{\geq 0}(C), \leq)$, as do ideals $(\cal I_C, \subseteq)$.
The map between the two is order-reversing.
The meet of two divisors (their $\gcd$) corresponds to the join of two ideals (their ideal sum).
The join of two divisors (their $\lcm$) corresponds to the meet of two ideals (their ideal intersection).
We have the following equivalences of operations.
\begin{center}
  \begin{tabular}{c|c}
    Divisors & Ideals \\
    \hline
    $A + B$ & $I_A I_B$ \\
    $\lcm(A,B)$ & $I_A \cap I_B$ \\
    $\gcd(A,B)$ & $I_A + I_B$ \\
    $\bar A$ & $f : I_A$
  \end{tabular}
\end{center}
where $f$ is ``minimal'' in $I_A$.
This last operation we define now.



\subsection{The Flip Operation}

If $D$ is a divisor and $I_D$ its ideal,
then there is a unique monic polynomial that is minimal with respect to the monomial order on $K[C]$.
When $I_D$'s unique reduced Gr\"obner basis is known,
this minimal element is merely the first of the Gr\"obner basis generators.

Let $f$ be the minimal element of $I_D$.
By Corollary \ref{cor_integral_ideal_inverse}, $f : I_D \equiv I_D\inv$.
Now define the \defn{flip of $D$} to be
  \[ \bar D := \div(f : I_D). \]
Then $\bar D \equiv -D$.

Of course, one may choose some non-minimal $g \in I_D$ and compute $\div(g : I_D)$ to get some other
divisor equivalent to $-D$.
Once we have defined what a reduced divisor is, we can show that, if $f$ is chosen to be minimal in $I_D$,
then $\bar D$ is reduced.

\note{Add geometric interpretation of flipping, with pictures.}



\subsection{Reduced Divisors}

\begin{definition}
  \label{def_reduced_divisor}
  Let $D \geq 0$ be a divisor in $\Div_K^0(C)$.
  Then $D$ is called \defn{reduced} if $\bar{\bar D} = D$.
\end{definition}

\begin{proposition}
  \label{prop_flip_properties}
  Let $A, B \in \Div_K^{\geq 0}(C)$.
  \begin{enumerate}[label=(\roman*)]
    \item $\bar A \equiv -A$;
    \item $\bar{\bar A} \equiv A$;
    \item $A \equiv B \iff \bar A = \bar D$;
    \item $\bar{\bar{\bar A}} = \bar A$;
    \item $\bar A$ is reduced.
  \end{enumerate}
\end{proposition}
\begin{proof}
  \begin{enumerate}[label=(\roman*)]
    \item 
    \item Immediate by part (i).
    \item
      ($\implies$)
      Suppose $A \equiv B$.
      Then in the ideal class group, $I_A \equiv I_B$,
      so that there are polynomials $f, g \in K[C]$ such that $gI_A = fI_B$.
      Without loss of generality, we may assume $f$ and $g$ are monic.
      Let $a$ and $b$ be the minimal polynomials in $I_A$ and $I_B$, respectively.
      Then the minimum polynomials in $gI_A$ and $fI_B$ are $ga$ and $fb$, respectively.
      Since $gI_A = fI_B$, we have $ga = fb$.
      
      Suppose $h \in a : I_A$. Then
      \begin{align*}
        hI_A &\subseteq \pid a \\
        hgI_A &\subseteq \pid{ga} \\
        hfI_B &\subseteq \pid{fb} \\
        hI_B &\subseteq \pid b,
      \end{align*}
      so $h \in b : I_B$.
      Likewise, if $h \in b : I_B$, then $h \in a : I_A$.
      Hence $a : I_A = b : I_B$ and $\bar A = \bar B$.
      
      ($\impliedby$)
      If $\bar A = \bar B$, then
      \[ A \equiv - \bar A = - \bar B \equiv B. \]
    \item By part (ii), $\bar{\bar A} \equiv A$.
          By part (iii), $\bar{\bar{\bar A}} = \bar A$.
    \item After part (iv), immediate by Definition \ref{def_reduced_divisor}.
  \end{enumerate}
\end{proof}

This proposition shows that if we flip a divisor $D$, we get a \emph{reduced} divisor equivalent to $-D$.
By flipping $D$ twice, we obtain a \emph{reduced} divisor equivalent to $D$ itself.
To reduce a divisor, we may flip it twice.

\begin{theorem}
  Every divisor class $[D]$ has a unique reduced representative.
\end{theorem}
\begin{proof}
  Existence is easy to demonstrate.
  Let $[D]$ be a divisor class with a representative $D$.
  Then $\bar{\bar D}$ is a reduced representative of $[D]$.
  
  Now we show uniqueness.
  Suppose $A$ and $B$ are reduced divisors in the same divisor class.
  Then $A \equiv B$.
  Applying Proposition \ref{prop_flip_properties}.(iii) twice,
  we have $\bar A = \bar B$ and $\bar{\bar A} = \bar{\bar B}$.
  By Definition \ref{def_reduced_divisor},
    \[ A = \bar{\bar A} = \bar{\bar B} = B. \]
\end{proof}

If $D$ is a divisor, then the degree and type of $\bar D$ is determined by the type of $D$.
We may use the formula
\begin{equation}
  \label{eq_flip_degree}
  \deg \bar D = \deg \div f - \deg D,
\end{equation}
where $f$ is the minimal polynomial in $I_D$. The degree of $\div f$ is determined by $\LM(f)$,
which is determined in turn by the type of $D$.
\begin{example}
  Suppose $D$ is a type 51 divisor.
  Then the minimal polynomial of $I_D$ is of the form
  \[ y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0, \]
  and
  \[ \bar D \simeq f : I_D \simeq \div f - D. \]
  So
  \[ \deg \bar D = \deg \div f - \deg D = 8 - 5 = 3. \]
\end{example}

\begin{center}
  \begin{tabular}{r|cccccccccc}
    $\type(D)$    & 0 & 11 & 21 & 22 & 31 & 32 & 33 & 41 & 42 & 43 \\
    \hline
    $\deg \bar D$ & 0 & 2  & 2  & 1  & 3  & 1  & 0  & 3  & 2  & 2
  \end{tabular}
    
  \begin{tabular}{r|cccccccccc}
    $\type(D)$    & 44 & 51 & 52 & 53 & 54 & 61 & 62 & 63 & 64 & 65 \\
    \hline 
    $\deg \bar D$ & 0  & 3  & 2  & 2  & 1  & 3  & 2  & 2  & 1  & 0
  \end{tabular}
\end{center}

For each divisor $D$ of degree 3 or less, we can determine the type of $\bar D$.
\begin{example}
  Let $D$ be a type 11 divisor.
  Then the minimal polynomial of $I_D$ is of the form $f = x + f_0$,
  and $\deg \bar D = \deg \div f - \deg D = 3 - 1 = 2$.
  So $\bar D$ is of type 21 or 22.
  However, $f \in f : I_D = I_{\bar D}$,
  so $\LT(f) = x \in \LT(I_{\bar D})$.
  Now $\bar D$ cannot be of type 21, because $x \not\in \pid{y, x^2}$.
  so $\bar D$ must be of type 22.
\end{example}

Applying this reasoning to each divisor type of degree 3 or less,
we can fill the table
\begin{center}
  \begin{tabular}{r|cccccccccc}
    $\type(D)$             & 0 & 11 & 21 & 22 & 31 & 32 & 33 \\
    \hline
    $\type(\bar D)$        & 0 & 22 & 21 & 11 & 31 & 11 & 0 \\
    $\type(\bar {\bar D})$ & 0 & 11 & 21 & 22 & 31 & 22 & 0
  \end{tabular}
\end{center}

\begin{theorem}
  A divisor is reduced if and only if it is of type 0, 11, 21, 22, or 31.
\end{theorem}
\begin{proof}
  A reduced divisor has degree 3 or less, therefore it must be of type 0, 11, 21, 22, 31, 32, or 33.
  On examination of the above table, if $D$ is of type 32 or 33, then $\bar{\bar D}$ is of a different type.
  Hence $D \neq \bar{\bar D}$ and $D$ is not reduced.
  However, if $D$ is of a type other than 32 or 33,
  then $\deg D = \deg \bar{\bar D}$ and $D \equiv \bar{\bar D}$,
  so $D = \bar{\bar D}$ and $D$ is reduced.
\end{proof}



\subsection{Typical Divisors}

Recent publications on $C_{3,4}$ curve divisor arithmetic focused only on so-called ``typical'' divisors.
Authors have recognized some types of divisors as being more commonly encountered than others.
When the curve $C$ is defined over a sufficiently large base field,
the probability of encountering an atypical divisor is vanishingly small.

In \cite{kmakdisi18}, the author defines semi-typical and typical divisors
and in Proposition 2.12 of the same article gives a characterization of degree 3 semi-typical and typical divisors.
We adopt the same definition here.
\begin{definition}
  A divisor $D$ is called \defn{semi-typical} if $I_D = \pid{f, g, h}$ where
  \begin{enumerate}[label=(\roman*)]
    \item $\{f, g, h\}$ are a reduced Gr\"obner basis for $I_D$;
    \item $-\nu_{P_\infty}(f) = \deg D + 3$;
    \item $-\nu_{P_\infty}(g) = \deg D + 4$; and
    \item $-\nu_{P_\infty}(h) = \deg D + 5$.
  \end{enumerate}
\end{definition}
Divisors of types 31, 41, 51, and 61 are semi-typical.
There exist also semi-typical divisors of degrees 7 and greater.
\begin{definition}
  A divisor $D$ is called \defn{typical} if $D$ is semi-typical and $I_D = \pid{f, g}$.
\end{definition}
That is, while $\{f, g\}$ alone are not a Gr\"obner basis for $I_D$,
they are still enough to generate $I_D$ if $D$ is typical.

\begin{proposition}
  Let $D$ be a type 31 divisor.
  The minimal polynomial in $I_D$ is $f = x^2 + f_2y + f_1x + f_0$.
  Then $D$ is typical if and only if $f_2 \neq 0$.
\end{proposition}
\begin{proof}
  If $D$ is of type 31, then $I_D$ is generated by three polynomials
  \begin{align*}
    f &= x^2 + f_2y + f_1x + f_0 \\
    g &= xy  + g_2y + g_1x + g_0 \\
    h &= y^2 + h_2y + h_1x + h_0.
  \end{align*}
  Suppose $f_2 \neq 0$. Let
  \[ k = \frac {(y + g_1)f - (x + f_1 - g_2)g} {f_2}. \]
  One can verify that $k$ is monic, has leading monomial $y^2$,
  and has no $xy$ or $x^2$ terms. Thus
  \[ k = y^2 + k_2y + k_1x + k_0 \]
  for some coefficients $k_0, k_1, k_2$.
  Since $\{f,g,h\}$ is a reduced Gr\"obner basis, $h$ is the unique polynomial of this form, so $k = h$.
  Hence $I_D = \pid{f,g,h} = \pid{f,g}$.
\end{proof}

\begin{itemize}
  \item Oyono's definition
  \item Kamal's definition
  \item Comparison to Arita
  \item Type *1 can typically be represented by first two polys.
\end{itemize}

\begin{theorem}
  A divisor $D$ is semi-typical if and only if its flip $\bar D$ is semi-typical.
\end{theorem}
\begin{proof}
  ($\implies$)
  Suppose $D$ is semi-typical.
  Let $f$ be the minimal polynomial in $I_D$.
  Then $-\nu_{P_\infty}(f) = \deg D + 3$.
  By Equation \ref{eq_flip_degree}, $\deg \bar D = 3$.
  Since $\bar D$ is reduced and of degree 3, $\bar D$ is of type 31, hence semi-typical.
  
  ($\impliedby$)
  Suppose $\bar D$ is semi-typical.
  Then $\bar D$ is of type 31.
  So, too, is $\bar{\bar D}$ of type 31, and $\bar{\bar D} \equiv D$.
  Let $I_{\bar {\bar D}} = \pid{u,v,w}$.
  Then $u$ is minimal in $I_{\bar{\bar D}}$,
  $-\nu_{P_\infty}(u) = 6$, $-\nu_{P_\infty}(v) = 7$, and $-\nu_{P_\infty}(w) = 8$.
  Now let $f$ be minimal in $I_D$.
  By Equation \ref{eq_flip_degree}, $-\nu_{P_\infty}(f) = \deg D + 3$.
  By \note{a lemma I haven't proven yet},
  \[ fI_{\bar{\bar D}} = uI_D, \]
  hence $\pid{fu, fv, fw} = \pid{fu, gu, hu}$, and $fv = gu$ and $fw = hu$.
  Then
  \begin{align*}
    -\nu_{P_\infty}(fv) &= -\nu_{P_\infty}(gu) \\
    -\nu_{P_\infty}(v) + \nu_{P_\infty}(u) &= -\nu_{P_\infty}(g) + \nu_{P_\infty}(f) \\
    7 - 6 &= -\nu_{P_\infty}(g) - \deg D - 3\\
    -\nu_{P_\infty}(g) &=  \deg D + 4.
  \end{align*}
  Likewise, $-\nu_{P_\infty}(h) =  \deg D + 5$.
\end{proof}

\begin{theorem}
  A divisor $D$ is typical if and only if its flip $\bar D$ is typical.
\end{theorem}
\begin{proof}
  \note{TODO}
\end{proof}



\subsection{Geometric Interpretations}

Here, we ascribe some geometric meaning to each divisor type of degree 3 or less.

\subsubsection{Type 0}
  There is only one type 0 divisor, the zero divisor, i.e. the empty sum.

\subsubsection{Type 11}
  If $D$ is of type 11, then $I_D = \pid{x - x_0, y - y_0}$, and $D = P$ where $P$ is the point $(x_0, y_0)$.
  Since $x - x_0$ and $y - y_0$ have $K$-rational coefficients, $P$ is a $K$-rational point.
  By the Hasse-Weil Bound \note{Source?}, there are approximately $q$ type 11 divisors if $C$ is defined over $\bb F_q$.

\subsubsection{Type 21}
  If $D$ is of type 21, then $I_D = \pid{f, g}$, where $f$ is the non-vertical line $y + f_1x + f_0$
  and $g$ is the univariate polynomial $x^2 + g_1x + g_0$.
  Thus $D$ is the sum of two points on the line $f$, whose $x$-coordinates are the roots of $g$.
  
  There are two possibilities.
  If $g$ has two distinct roots, then $D = P + Q$ for two distinct points $P$ and $Q$.
  If $g$ has a double root, then $D = 2P$ and $f$ is the tangent line at $P$.
  
  So either $D$ is the sum of two distinct points with different $x$-coordinates,
  or $D$ is a double point $D = 2P$ and the tangent line at $P$ is non-vertical.

\subsubsection{Type 22}
  If $D$ is of type 21, then $I_D = \pid{f, g}$, where $f$ is the vertical line $x + f_0$
  and $g$ is the univariate polynomial $y^2 + g_2y + g_0$.
  
  Either $D = P + Q$ is the sum of two distinct points with the same $x$-coordinate but different $y$-coordinates,
  or $D = 2P$ is a double point and the tangent line at $P$ is vertical.

\subsubsection{Type 31}
  If $D$ is of type 31, then $I_D = \pid{f, g, h}$, where $f$ is the parabola $x^2 + f_2y + f_1x + f_0$,
  $g$ is the hyperbola $xy + g_2y + g_1x + g_0$, and $h$ is the parabola $y^2 + h_2y + h_1x + h_0$.
  
  Either $D$ is the sum of three, two, or one distinct points.
  
  If $D = P + Q + R$ is the sum of three distinct points, then these points are non-colinear.
  If $D = 2P + Q$ is the sum of two distinct points, then the tangent line at $P$ does not pass through $Q$.
  If $D = 3P$ is a triple point, then the $P$ is not an inflection point.

\subsubsection{Type 32}
  If $D$ is of type 32, then $I_D = \pid{f, g}$, where $f$ is the non-vertical line $y + f_1x + f_0$
  and $g$ is the univariate polynomial $x^3 + g_3x^2 + g_1x + g_0$.
  Thus all points in $D$ must be colinear, falling on the line $f$.
  
  If $D = P + Q + R$ is the sum of three distinct points, then their $x$-coordinates are the roots of $g$.
  If $D = 2P + Q$ is the sum of two points, then the tangent line at $P$ is $f$, which also passes through $Q$,
  and the $x$-coordinate of $P$ is a double root of $g$.
  If $D = 3P$ is a triple point, then $P$ is an inflection point, $f$ is the tangent line at $P$, and $g$ has a triple root,
  the $x$-coordinate of $P$.

\subsubsection{Type 33}
  If $D$ is of type 32, then $I_D = \pid{f}$ is a principal ideal and $f$ is the vertical line $x + f_0$.
  The points in $D$ necessarily have the same $x$-coordinate, $-f_0$.
  If $D = P + Q + R$ is the sum of three distinct points, then these points have pairwise distinct $y$-coordinates.
  If $D = 2P + Q$, then $P$ and $Q$ have distinct $y$-coordinates and $f$ is the tangent line at $P$, which passes also through $Q$.
  If $D = 3P$ is a triple point, then $P$ is an inflection point and $f$ is the tangent line at $P$.



\subsection{Type 31 Divisors}

\begin{itemize}
  \item
\end{itemize}



\subsection{Type 61 Divisors}

\begin{itemize}
  \item
\end{itemize}



\subsection{Figure out how to organize this}

\begin{lemma}
  Let $D$ be a divisor with ideal $I_D$.
  Fix $b \in \bb N$.
  There is a minimal non-zero monic polynomial in the set $\{ f \in I_D ~|~ y^b \text{ divides } \LT(f)\}$.
\end{lemma}
This polynomial is minimal in the sense that, if $g$ is any other polynomial such that $y^b|\LT(g)$,
then $\LT(f)|\LT(g)$.
This polynomial $f$ is not necessarily unique.
\begin{proof}
  Follows from a monomial order being a well-order.
\end{proof}

\begin{lemma}
  Let $D$ be a divisor with ideal $I_D$.
  There exist polynomials $f, g, h$ such that $I_D = \pid{f, g, h}$,
  $\LT(f) = x^c$,
  $\LT(g) = x^by$,
  $\LT(h) = x^ay^2$,
  $f$, $g$, and $h$ are minimal in the sense of the previous lemma,
  and $a \leq b \leq c$.
\end{lemma}
\begin{proof}
  Everything but the relation $a \leq b \leq c$ is immediate from the previous lemma.
  To prove this relation holds, suppose $b < a$.
  Then $y^2$ divides $\LT(gy)$ and $\LT(gy)$ divides $\LT(h)$, but $\LT(h)$ does not divide $\LT(gy)$,
  so $h$ was not minimal. Hence $a \leq b$.
  The same argument can be used to show $b \leq c$.
\end{proof}

\begin{lemma}
  Let $D$ be a divisor with ideal $I_D$.
  Let $I_D = \pid{f, g, h}$ as in the previous lemma.
  Then $\pid{f, g, h}$ is a (not necessarily reduced) Gr\"obner basis for $I_D$.
\end{lemma}
\begin{proof}
  \note{TODO???}
\end{proof}

\begin{lemma}
  Let $D$ be a divisor with ideal $I_D$.
  Let $I_D = \pid{f, g, h}$ as in the previous lemma.
  Then $a + b + c = \deg D$.
\end{lemma}
\begin{proof}
  We have that
  \[ \deg D = \dim \frac {K[C]}{I_D} = \dim \frac {K[C]}{\pid{f,g,h}}
%            = \dim \frac {K[C]}{\pid{x^c + \ldots, x^by + \ldots, x^ay^2 + \ldots}}
            = \dim \frac {K[C]}{\pid{x^c, x^by, x^ay^2}}. \]
  \note{And this is equal to $a + b + c$.}
\end{proof}

\begin{theorem}
  Let $D$ be a divisor with ideal $I_D$.
  Let $f$ be minimal in $I_D$. Then
  \[ -\nu_{P_\infty}(f) - \deg D \leq 3. \]
\end{theorem}
\begin{proof}
  Let $I_D = \pid{f, g, h}$ as in the previous lemma.
  The minimal polynomial of $I_D$ is either $f$, $g$, or $h$.
  Consider each case separately.
  \begin{description}
    \item[$f$ is minimal in $I_D$:]
      Then $\nu_{P_\infty}(f)$ is less than both $\nu_{P_\infty}(g)$ and $\nu_{P_\infty}(h)$.
      So $3c \leq 3b + 4$ and $3c \leq 3a + 8$, which implies
      $c - b \leq 1$ and $c - a \leq 2$. Then
      \begin{align*}
        -\nu_{P_\infty}(f) - \deg D
          &= 3c - (a + b + c) \\
          &= (c - a) + (c - b) \\
          &\leq 2 + 1 = 3.
      \end{align*}
      
    \item[$g$ is minimal in $I_D$:]
      Then $3b + 4 < 3c$ and $3b + 4 < 3a + 8$,
      which implies $b - c \leq -2$ and $b - a \leq 1$, so
      \begin{align*}
        -\nu_{P_\infty}(f) - \deg D
          &= 3b + 4 - (a + b + c) \\
          &= 4 + (b - a) + (b - c) \\
          &\leq 4 + 1 - 2 = 3.
      \end{align*}

    \item[$h$ is minimal in $I_D$:]
      Then $3a + 8 < 3c$ and $3a + 8 < 3b + 4$,
      which implies $a - c \leq -3$ and $a - b \leq -2$, so
      \begin{align*}
        -\nu_{P_\infty}(f) - \deg D
          &= 3a + 8 - (a + b + c) \\
          &= 8 + (a - b) + (a - c) \\
          &\leq 8 - 2 - 3 = 3.
      \end{align*}
  \end{description}
\end{proof}

\begin{theorem}
  Every reduced divisor on $C$ has degree at most 3.
\end{theorem}
\begin{proof}
  By the previous theorem, for any divisor $D$, $\bar D$ has degree at most 3, since
  \[ \deg \bar D = -\nu_{P_\infty}(f) - \deg D \leq 3. \]
  If $D$ is reduced, then $D$ is the flip of $\bar D$.
  Therefore $D$ has degree at most 3.
\end{proof}
