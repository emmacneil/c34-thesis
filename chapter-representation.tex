%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                    %%%%%
%%%%%   Representation   %%%%%
%%%%%                    %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Representation}
\label{chap_representation}

In Chapter \ref{chap_divisors}, we defined the divisor class group of a curve,
and in Chapter \ref{chap_ideals}, we showed that this group is isomorphic to an ideal class group.
This forms the foundation of our representation of divisors.
We will represent an effective divisor by its associated integral ideal,
or more specifically, by the unique reduced Gr\"obner basis of that ideal.
These bases come in many forms, but if we place a bound on the degree of the divisors under consideration,
these forms are only finite in number.

In this chapter, we will tabulate all the different types of divisors of degree 6 or less.
When adding divisors in Chapter \ref{chap_addition},
we will always assume our summands are of degree 3 or less,
thus it is unnecessary to tabulate divisors of degree 7 and higher.
We will see which of these types are reduced (not equivalent to a divisor of lesser degree)
and which are typical (the statistically most likely to be encountered).



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                   %%%%%
%%%%%   Divisor Types   %%%%%
%%%%%                   %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Divisor Types}

In \cite{arita05-2}, Arita classifies divisors of degree 6 and less into 19 types
based on the forms of the reduced Gr\"obner bases of their ideals.
This classification is reproduced in Table \ref{tab_divisor_types},
along with a 20th type representing the divisor 0.
Divisors are listed by degree (D), then by type (T).

\begin{table}[hb!]
\caption{Classification of divisors into types}
\label{tab_divisor_types}
\begin{center}
\begin{tabular}{l|l|l||l|l|l}
  %Degree & Type & Basis & Degree & Type & Basis \\
  D & T & Gr\"obner Basis & D & T & Gr\"obner Basis \\
  \hline
  0 & 0 & $1$ & \multirow{9}{*}{5} &\multirow{3}{*}{51} & $y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0$, \\
  \cline{1-3}
  \multirow{2}{*}{1} &\multirow{2}{*}{11} & $x + f_0$ & & & $x^3 + g_4xy + g_3x^2 + g_2y + g_1x + g_0$, \\
    & & $y + g_0$ & & & $x^2y + h_4xy + h_3x^2 + h_2y + h_1x + h_0$ \\
  \cline{1-3}\cline{5-6}
  \multirow{4}{*}{2} &\multirow{2}{*}{21} & $y + f_1x + f_0$, & & \multirow{2}{*}{52} & $xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    & & $x^2 + g_1x + g_0$ & & & $y^2 + g_3x^2 + g_2y + g_1x + g_0$ \\
    \cline{2-3}\cline{5-6}
    &\multirow{2}{*}{22}  & $x + f_0$, & & \multirow{2}{*}{53} & $xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    & & $y^2 + g_2y + g_0$ & & & $x^3 + g_5y^2 + g_3x^2 + g_2y + g_1x + g_0$ \\
  \cline{1-3}\cline{5-6}
  \multirow{6}{*}{3} &\multirow{3}{*}{31} & $x^2 + f_2y + f_1x + f_0$, & & \multirow{2}{*}{54} & $x^2 + f_2y + f_1x + f_0$, \\
    & & $xy + g_2y + g_1x + g_0$, & & & $xy^2 + g_5y^2 + g_4xy + g_2y + g_1x + g_0$ \\
  \cline{4-6}
    & & $y^2 + h_2y + h_1x + h_0$ & \multirow{10}{*}{6} &\multirow{3}{*}{61} & $x^3 + f_5y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    \cline{2-3}
    &\multirow{2}{*}{32} & $y + f_1x + f_0$, & & & $x^2y + g_5y^2 + g_4xy + g_3x^2 + g_2y + g_1x + g_0$, \\
    & & $x^3 + g_3x^2 + g_1x + g_0$ & & & $xy^2 + h_5y^2 + h_4xy + h_3x^2 + h_2y + h_1x + h_0$ \\
    \cline{2-3}\cline{5-6}
    &\multirow{1}{*}{33} & $x + f_0$ & &\multirow{2}{*}{62} & $y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0$, \\
  \cline{1-3}
  \multirow{8}{*}{4} &\multirow{3}{*}{41} & $xy + f_3x^2 + f_2y + f_1x + f_0$, & & & $x^3 + g_4xy + g_3x^2 + g_2y + g_1x + g_0$ \\
  \cline{5-6}
    & & $y^2 + g_3x^2 + g_2y + g_1x + g_0$, & &\multirow{2}{*}{63} & $y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    & & $x^3 + h_3x^2 + h_2y + h_1x + h_0$ & & & $x^2y + g_6x^3 + g_4xy + g_3x^2 + g_2y + g_1x + g_0$ \\
    \cline{2-3}\cline{5-6}
    &\multirow{2}{*}{42} & $x^2 + f_1x + f_0$, & &\multirow{2}{*}{64} & $xy + f_3x^2 + f_2y + f_1x + f_0$, \\
    & & $xy + g_2y + g_1x + g_0$ & & & $x^4 + g_6x^3 + g_5y^2 + g_3x^2 + g_2y + g_1x + g_0$ \\
    \cline{2-3}\cline{5-6}
    &\multirow{2}{*}{43} & $x^2 + f_2y + f_1x + f_0$, & &\multirow{1}{*}{65} & $x^2 + f_2y + f_1x + f_0$ \\
    \cline{4-6}
    & & $y^2 + g_4xy + g_2y + g_1x + g_0$ \\
    \cline{2-3}
    &\multirow{1}{*}{44}
      & $y + f_1x + f_0$
\end{tabular}
\end{center}
\end{table}

So, for example, divisors of degree 2 come in two types: type 21 and type 22.
If $D$ is a type 21 divisor,
then the unique reduced Gr\"obner basis of $I_D$ is of the form $\pid{y + f_1x + f_0, x^2 + g_1x + g_0}$,
where $f_0$, $f_1$, $g_0$, and $g_1$ lie in the base field $K$ over which the curve is defined.
If $D$ is instead a type 22 divisor,
then the unique reduced Gr\"obner basis of $I_D$ is of the form $\pid{x + f_0, y^2 + g_2y + g_0}$.

The type 42 divisor in this table differs slightly from the type 42 divisor as presented by Arita in \cite{arita05-2}.
In \cite{arita05-2}, a type 42 divisor has a generator of the form $x^2 + a_3y + a_2x + a_1$,
though in the table above, the coefficient of $y$ is assumed to be 0.
One can show that, were the coefficient of $y$ non-zero, the divisor would be of type 31 instead.
(See Theorem \ref{thm_typical_type_31_divisors}, below).

This table hides the fact that there are many dependencies between the coefficients.
For instance, it can be shown that type 11 divisors are in bijection with type 22 divisors.
Type 22 divisors, in a sense, carry only as much information as type 11 divisors.
Where the latter are specified uniquely by two field elements,
one would hope that type 22 divisors could also be represented by only two elements.
Indeed, one can show that if $\pid{x + f_0, y^2 + g_2y + g_0}$
is in bijection with some type 11 divisor $\pid{x + f_0, y + g'_0}$, then
  \[ g = y^2 + g_2y + g_0 = \frac {C(-f_0, y)}{y - g'_0}. \]
Hence $f_0, g_0, g_2$ can be written in terms of $f_0, g'_0$ and the curve coefficients,
so that there is some dependency between the three.

As another example, a type 31 divisor is generated by three polynomials $f$, $g$, and $h$,
but typically $h \in \pid{f,g}$.
(See Definition \ref{def_typical_divisor} and Theorem \ref{thm_typical_type_31_divisors}.)
This implies that the coefficients of $h$ depend on the coefficients of $f$, $g$, and the curve equation $C$.



%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                %%%%%
%%%%%   Operations   %%%%%
%%%%%                %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Operations}

Chapter \ref{chap_ideals} established the correspondence between divisors and ideals.
Addition of divisors is equivalent to multiplication of ideals.
What's more, for divisors $A, B$, $A \leq B \iff I_B \subseteq I_A$.
Divisors form a lattice $(\Div_K^{\geq 0}(C), \leq)$, as do ideals $(\cal I_C, \subseteq)$.
The map between the two is order-reversing.
The meet of two divisors (their $\gcd$) corresponds to the join of two ideals (their ideal sum).
The join of two divisors (their $\lcm$) corresponds to the meet of two ideals (their ideal intersection).
We have the following equivalences of operations.
\begin{center}
  \begin{tabular}{c|c}
    Divisors & Ideals \\
    \hline
    $A + B$ & $I_A I_B$ \\
    $\lcm(A,B)$ & $I_A \cap I_B$ \\
    $\gcd(A,B)$ & $I_A + I_B$ \\
    $\bar A$ & $f : I_A$
  \end{tabular}
\end{center}
where $f$ is the minimum polynomial\footnote{As in Definition \ref{def_minimum_polynomial}.} in $I_A$.
This last operation we define now.
\begin{definition}
  Let $D$ be a divisor, with corresponding ideal $I_D$ in the ideal class group.
  Let $f$ be the minimum polynomial of $I_D$.
  The \defn{flip of $D$} is the divisor
  \[ \bar D := \div(f : I_D). \]
\end{definition}
By Proposition \ref{prop_integral_ideal_inverse}, $f : I_D \equiv I_D\inv$ in the ideal class group,
so $\bar D \equiv -D$ in the divisor class group.

Of course, one may choose some non-minimum polynomial $g \in I_D$ and compute $\div(g : I_D)$ to get some other
divisor, which is also equivalent to $-D$ by Proposition \ref{prop_integral_ideal_inverse}.
Once we have defined what a reduced divisor is, we can show that,
if $f$ is chosen to be the minimum polynomial in $I_D$, then $\bar D$ is reduced.

Geometrically, to flip a divisor $D$ is to find the polynomial $f$ of least degree interpolating the points of $D$,
then taking the zeroes of $f$ along $C$ that are not in $D$, properly accounting for multiplicity.
\begin{example}
  See Figure \ref{fig_divisor_flip}.
  The three black points form a degree 3, type 31 divisor $D$. 
  The minimum polynomial $f = x^2 + f_2y + f_1x + f_0 \in I_D$
  is a parabola which interpolates these points.
  This parabola intersects $C$ at six points -- the points of $D$ plus three other points.
  The flip $\bar D$ consists of the three white points not in $D$.
\end{example}

\begin{figure}[ht!]
  \caption{A degree 3 divisor and its flip.}
  \label{fig_divisor_flip}
  \begin{center}
    \includegraphics{gnuplot/flip.pdf}
  \end{center}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                      %%%%%
%%%%%   Reduced Divisors   %%%%%
%%%%%                      %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Reduced Divisors}

\begin{definition}
  \label{def_reduced_divisor}
  Let $D \geq 0$ be a divisor in $\Div_K^0(C)$.
  Then $D$ is called \defn{reduced} if $\bar{\bar D} = D$.
\end{definition}

\begin{proposition}
  \label{prop_flip_properties}
  Let $A, B \in \Div_K^{\geq 0}(C)$.
  \begin{enumerate}[label=(\roman*)]
    \item $\bar A \equiv -A$;
    \item $\bar{\bar A} \equiv A$;
    \item $A \equiv B \iff \bar A = \bar B$;
    \item $\bar{\bar{\bar A}} = \bar A$;
    \item $\bar A$ is reduced.
  \end{enumerate}
\end{proposition}
\begin{proof}
  \begin{enumerate}[label=(\roman*)]
    \item This is simply Proposition \ref{prop_integral_ideal_inverse} translated into the language of divisors.
    \item Immediate by part (i).
    \item
      ($\implies$)
      Suppose $A \equiv B$.
      Then in the ideal class group, $I_A \equiv I_B$,
      so that there are polynomials $f, g \in K[C]$ such that $gI_A = fI_B$.
      Without loss of generality, we may assume $f$ and $g$ are monic.
      Let $a$ and $b$ be the minimal polynomials in $I_A$ and $I_B$, respectively.
      Then the minimum polynomials in $gI_A$ and $fI_B$ are $ga$ and $fb$, respectively.
      Since $gI_A = fI_B$, we have $ga = fb$.
      
      Suppose $h \in a : I_A$. Then
      \begin{align*}
        hI_A &\subseteq \pid a \\
        hgI_A &\subseteq \pid{ga} \\
        hfI_B &\subseteq \pid{fb} \\
        hI_B &\subseteq \pid b,
      \end{align*}
      so $h \in b : I_B$.
      Likewise, if $h \in b : I_B$, then $h \in a : I_A$.
      Hence $a : I_A = b : I_B$ and $\bar A = \bar B$.
      
      ($\impliedby$)
      If $\bar A = \bar B$, then
      \[ A \equiv - \bar A = - \bar B \equiv B. \]
    \item By part (ii), $\bar{\bar A} \equiv A$.
          By part (iii), $\bar{\bar{\bar A}} = \bar A$.
    \item After part (iv), immediate by Definition \ref{def_reduced_divisor}.
  \end{enumerate}
\end{proof}

This proposition is central to the divisor class arithmetic described in this thesis
and the unique representation of divisor classes.
Given any divisor class $[D]$, we can find a reduced member of that class by
flipping $D$ twice, computing $\bar{\bar D}$. As the next theorem shows,
this reduced representative is \emph{unique}.

\begin{theorem}
  Every divisor class $[D]$ has a unique reduced representative.
\end{theorem}
\begin{proof}
  If $[D]$ is a divisor class, then $\bar{\bar D}$ is a reduced divisor in the same class,
  establishing existence.
  
  For uniqueness, suppose $A$ and $B$ are equivalent reduced divisors.
  Applying Proposition \ref{prop_flip_properties}.(iii) twice,
  we have $\bar A = \bar B$ and $\bar{\bar A} = \bar{\bar B}$.
  By Definition \ref{def_reduced_divisor},
    \[ A = \bar{\bar A} = \bar{\bar B} = B. \]
\end{proof}

Another consequence of Proposition \ref{prop_flip_properties} is the following,
which we will make use of many times later in this chapter.
\begin{proposition}
  \label{prop_aI_B_is_bI_A}
  Let $I_A$ and $I_B$ be ideals with $I_A \equiv I_B$.
  Let $a$ and $b$ be the minimum polynomials in $I_A$ and $I_B$, respectively.
  Then $aI_B = bI_A$.
\end{proposition}
\begin{proof}
  \begin{align*}
    I_A &\equiv I_B \\
    A &\equiv B \\
    \bar A &= \bar B \\
    a : I_A &= b : I_B \\
    (a : I_A)I_AI_B &= (b : I_B)I_BI_A \\
    aI_B &= bI_A.
  \end{align*}
\end{proof}

If $D$ is a divisor, then the degree and type of $\bar D$ is determined by the type of $D$.
We may use the formula
\begin{equation}
  \label{eq_flip_degree}
  \deg \bar D = \deg (\div f) - \deg D,
\end{equation}
where $f$ is the minimum polynomial in $I_D$. The degree of $\div f$ is determined by $\LM(f)$,
which is determined in turn by the type of $D$.
\begin{example}
  Suppose $D$ is a type 51 divisor.
  The minimum polynomial $f$ of $I_D$ is
  \[ f = y^2 + f_4xy + f_3x^2 + f_2y + f_1x + f_0. \]
  Then
  \begin{align*}
    \deg \bar D &= \deg (\div f) - \deg D \\
                &= -\nu_{P_\infty}(f) - \deg D \\
                &= -\nu_{P_\infty}(y^2) - \deg D \\
                &= 8 - 5 = 3
                  & \text{By Prop. \ref{prop_pole_order_x_y}, $-\nu_{P_\infty}(y^2) = 8$.}
  \end{align*}
\end{example}

By applying Equation \ref{eq_flip_degree},
we can compute the degree of $\bar D$ for $D$ of any divisor type.
\begin{table}[hb!]
\caption{Divisor types and the degrees of their flips}
\label{tab_flip_degree}
\begin{center}
  \begin{tabular}{r|cccccccccc}
    $\type(D)$    & 0 & 11 & 21 & 22 & 31 & 32 & 33 & 41 & 42 & 43 \\
    \hline
    $\deg \bar D$ & 0 & 2  & 2  & 1  & 3  & 1  & 0  & 3  & 2  & 2
  \end{tabular}
    
  \begin{tabular}{r|cccccccccc}
    $\type(D)$    & 44 & 51 & 52 & 53 & 54 & 61 & 62 & 63 & 64 & 65 \\
    \hline 
    $\deg \bar D$ & 0  & 3  & 2  & 2  & 1  & 3  & 2  & 2  & 1  & 0
  \end{tabular}
\end{center}
\end{table}

We can do even better.
Not only can we determine the degree of $\bar D$, but also its type.
We begin by giving an example of this determination for a divisor of small degree.
After classifying reduced divisors, we will be able to do the same for divisors of degree greater than 3.

\begin{example}
  Let $D$ be a type 11 divisor.
  Then the minimum polynomial of $I_D$ is $f = x + f_0$ for some $f_0 \in K$.
  By equation \ref{eq_flip_degree}, $\deg(\bar D) = 2$, so $\bar D$ is of type 21 or 22.
  Since $f \in f : I_D = I_{\bar D}$, $\bar D$ must be of type 22 ---
  were $\bar D$ of type 21, its reduced Gr\"obner basis would have the form $\pid{y + \ldots, x^2 + \ldots}$,
  but such a basis cannot contain a polynomial with leading monomial $x$.
\end{example}

Applying this reasoning to each divisor type of degree 3 or less,
we can fill the table
\begin{table}[h]
\caption{(Small) Divisor types and the type of their flips}
\label{tab_small_flip_type}
\begin{center}
  \begin{tabular}{r|cccccccccc}
    $\type(D)$             & 0 & 11 & 21 & 22 & 31 & 32 & 33 \\
    \hline
    $\type(\bar D)$        & 0 & 22 & 21 & 11 & 31 & 11 & 0 \\
    $\type(\bar {\bar D})$ & 0 & 11 & 21 & 22 & 31 & 22 & 0
  \end{tabular}
\end{center}
\end{table}

We will make use of this table to argue that all reduced divisors are of type 0, 11, 21, 22, or 31.
First, we must show that all reduced divisors are of degree 3 or less.
It is a well-known fact that reduced divisors on an algebraic curve are of degree $g$ or less,
where $g$ is the genus of the curve, 3 in the $C_{3,4}$ curve case.
This fact is a consequence of the Riemann-Roch Theorem,
however in this thesis, reduced divisors have been defined in a non-standard way.
Rather than a diversion into Riemann-Roch theory,
we relegate to Appendix \ref{appendix_reduced_divisors}
a proof that reduced divisors have degree 3 or less using the theory of Gr\"obner bases.

\begin{theorem}
  \label{thm_reduced_divisor_types}
  A divisor is reduced if and only if it is of type 0, 11, 21, 22, or 31.
\end{theorem}
\begin{proof}
  By Theorem \ref{thm_reduced_divisor_degree},
  a reduced divisor has degree 3 or less, therefore it must be of type 0, 11, 21, 22, 31, 32, or 33.
  On examination of the above table, if $D$ is of type 32 or 33, then $\bar{\bar D}$ is of a different type.
  Hence $D \neq \bar{\bar D}$ and $D$ is not reduced.
  
  Clearly, the divisor of type 0 is reduced, since $\bar{\bar 0} = 0$.
  
  Suppose $D$ is of type 31.
  (The argument to follow applies to types 11, 21, and 22, \emph{mutatis mutandis}.)
  Let $f$ be the minimum polynomial in $I_D$.
  Then $f \in I_{\bar D}$, and since $\bar D$ is also of type 31, $f$ must be the minimum polynomial in $I_{\bar D}$.
  So, too, is $f$ the minimum polynomial in $I_{\bar{\bar D}}$.
  By \ref{prop_aI_B_is_bI_A}, $f I_{\bar{\bar D}} = f I_D$, and
  \begin{align*}
    f I_{\bar{\bar D}} &= f I_D \\
    f I_{\bar{\bar D}} : f &= f I_D : f \\
    I_{\bar{\bar D}} &= I_D,
  \end{align*}
  hence $\bar{\bar D} = D$ and $D$ is reduced.
\end{proof}

We now give a couple more examples of determining types for flips of divisors
and fill in Table \ref{tab_small_flip_type} for all remaining divisor types.

\begin{example}
  Let $D$ be a type 61 divisor.
  By equation \ref{eq_flip_degree}, $\deg \bar D = 3$.
  By Proposition \ref{prop_flip_properties}, $\bar D$ is reduced.
  By Theorem \ref{thm_reduced_divisor_types}, $\bar D$ must be of type 31.
\end{example}
\begin{example}
  Let $D$ be a type 62 divisor.
  By equation \ref{eq_flip_degree}, $\deg \bar D = 2$, so $\bar D$ must be of type 21 or 22.
  The ideal of $D$ is $I_D = \pid{f,g}$,
  where $\LM(f) = y^2$ and $\LM(g) = x^3$.
  There is no polynomial $r \in f : g$ with leading monomial $y$.
  If there were, then there would be a polynomial $s \in K[C]$ such that $rg \equiv sf$. Then
  \begin{align*}
    -\nu_{P_\infty}(rg) &= -\nu_{P_\infty}(sf) \\
    -\nu_{P_\infty}(r) - \nu_{P_\infty}(g) &= -\nu_{P_\infty}(s) - \nu_{P_\infty}(f) \\
    4 + 9 &= -\nu_{P_\infty}(s) + 8 \\
    -\nu_{P_\infty}(s) &= 5.
  \end{align*}
  However, there is no polynomial in $K[C]$ with pole order 5 at infinity.
  
  Since no polynomial with leading monomial $y$ can exist in $f : g = I_{\bar D}$,
  $\bar D$ cannot be of type 21 and must therefore be of type 22.
\end{example}

\begin{table}[h!]
\caption{Divisor types and the type of their flips}
\label{tab_large_flip_type}
\begin{center}
  \begin{tabular}{r|cccccccccc}
    $\type(D)$             & 0 & 11 & 21 & 22 & 31 & 32 & 33 & 41 & 42 & 43 \\
    \hline
    $\type(\bar D)$        & 0 & 22 & 21 & 11 & 31 & 11 &  0 & 31 & 22 & 21 \\
    $\type(\bar {\bar D})$ & 0 & 11 & 21 & 22 & 31 & 22 &  0 & 31 & 11 & 21 \\
    \hline\hline
    $\type(D)$             & 44 & 51 & 52 & 53 & 54 & 61 & 62 & 63 & 64 & 65 \\
    \hline
    $\type(\bar D)$        &  0 & 31 & 22 & 21 & 11 & 31 & 22 & 21 & 11 &  0 \\
    $\type(\bar {\bar D})$ &  0 & 31 & 11 & 21 & 22 & 31 & 11 & 21 & 22 &  0 \\
  \end{tabular}
\end{center}
\end{table}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                      %%%%%
%%%%%   Typical Divisors   %%%%%
%%%%%                      %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Typical Divisors}

While some publications on $C_{3,4}$ curve divisor arithmetic have described algorithms for adding general divisors
\cite{arita05-2, harasawa00},
the most efficient algorithms have been from those publications that have focused only on ``typical'' divisors
\cite{salem07, kmakdisi18, flon08}.
These divisors are typical in the sense that, as $q \to \infty$,
over a finite field of order $q$,
the probability that a divisor chosen uniformly at random is typical is approximately $\frac {q - 1} q$;
the chance of encountering an atypical divisor becomes vanishingly small over large finite fields.

In \cite{kmakdisi18}, Khuri-Makdisi defines semi-typical and typical divisors of arbitrary curves
and in Proposition 2.12 of the same article gives a characterization of degree 3
semi-typical and typical divisors on $C_{3,4}$ curves.
We adopt the same definitions here, as they apply to the $C_{3,4}$ case.

\begin{definition}
  \label{def_semitypical_divisor}
  A divisor $D$ is called \defn{semi-typical} if $I_D = \pid{f, g, h}$ where
  \begin{enumerate}[label=(\roman*)]
    \item $\{f, g, h\}$ is a reduced Gr\"obner basis for $I_D$;
    \item $-\nu_{P_\infty}(f) = \deg D + 3$;
    \item $-\nu_{P_\infty}(g) = \deg D + 4$; and
    \item $-\nu_{P_\infty}(h) = \deg D + 5$.
  \end{enumerate}
\end{definition}

Divisors of types 31, 41, 51, and 61 are semi-typical.
There exist also semi-typical divisors of degrees 7 and greater.

\begin{definition}
  \label{def_typical_divisor}
  A divisor $D$ is called \defn{typical} if $D$ is semi-typical and $I_D = \pid{f, g}$.
\end{definition}

That is, while $\{f, g\}$ alone are not a Gr\"obner basis for $I_D$,
they are still enough to generate $I_D$ if $D$ is typical.

This definition of typicality differs from other authors' definitions.
Of note is this definition due to Flon et al.

\begin{definition}[Flon et al \cite{flon08}]
  \label{def_typical_divisor_flon}
  A degree 3 divisor is \defn{typical} if it is the sum of three non-collinear points
  with pairwise distinct $x$-coordinates.
\end{definition}

This definition more restrictive than Definition \ref{def_typical_divisor}.
This definition does not apply to divisors of degree other than 3.
In the degree 3 case, Definition \ref{def_typical_divisor} allows for points to appear with multiplicity
greater than one, as long as the interpolation polynomial through the three points is not a line.
Double and triple points are barred by Definition \ref{def_typical_divisor_flon}'s requirement that
points have pairwise distinct $x$-coordinates.
Going forward, we adopt Definition \ref{def_typical_divisor}.

A reduced divisor may be of type 0, 11, 21, 22, or 31,
but a reduced \emph{typical} divisor may only be of type 31.
However, not all type 31 divisors are typical (though they are all semi-typical).
Here we give a characterization of typical type 31 divisors.

\begin{theorem}[Khuri-Makdisi \cite{kmakdisi18}]
  \label{thm_typical_type_31_divisors}
  Let $D$ be a type 31 divisor, with minimum polynomial $x^2 + f_2y + f_1x + f_0 \in I_D$.
  Then $D$ is typical if and only if $f_2 \neq 0$.
\end{theorem}

\begin{proof}
  ($\implies$)
  Suppose $f_2 = 0$.
  Then $I_D = \pid{f, g, h}$ with
  \begin{align*}
    f &= x^2 + f_1x + f_0 \\
    g &= xy  + g_2y + g_1x + g_0 \\
    h &= y^2 + h_2y + h_1x + h_0.
  \end{align*}
  The polynomial $f$ factors into $(x - x_0)(x - x_1)$ for some $x_0, x_1 \in \bar K$.
  The divisor $D$ is the sum of three points, say $D = P + Q + R$.
  By the pigeonhole principle, at least two of these points fall on the same vertical line, $x - x_0$ or $x - x_1$.
  Without loss of generality, suppose $P$ and $Q$ fall on $x - x_0$.
  
  Geometrically, $g$ is a hyperbola through $P$, $Q$ and $R$.
  Either $g$ passes through two distinct points on the same vertical line,
  or if $P = Q$, $g$ is tangent to $C$ at $P$ and the tangent line to $C$ at $P$ is $x - x_0$.
  In either case, $g$ is a degenerate hyperbola and factors into a product of two lines, $g = (x - x_0)(y - y_0)$.
  
  Now suppose there are polynomials $r, s$ such that $h = rf + sg$.
  \begin{align*}
    y^2 &= \LM(h) \\
        &= \LM(rf + sg) \\
        &= \LM(r(x - x_0)(x - x_1) + s(x - x_0)(y - y_0)) \\
        &= \LM(x - x_0)\LM(r(x - x_1) + s(y - y_0)) \\
        &= x\LM(r(x - x_1) + s(y - y_0)).
  \end{align*}
  However, $x$ does not divide $y^2$, so no such polynomials $r$ and $s$ can exist.
  Therefore $D$ must be atypical.
  
  ($\impliedby$)
  Suppose $f_2 \neq 0$.
  Then $I_D$ is generated by three polynomials
  \begin{align*}
    f &= x^2 + f_2y + f_1x + f_0 \\
    g &= xy  + g_2y + g_1x + g_0 \\
    h &= y^2 + h_2y + h_1x + h_0.
  \end{align*}
  Let
  \[ k = \frac {(y + g_1)f - (x + f_1 - g_2)g} {f_2}. \]
  One can verify that $k$ is monic, has leading monomial $y^2$,
  and has no $xy$ or $x^2$ terms. Thus
  \[ k = y^2 + k_2y + k_1x + k_0 \]
  for some coefficients $k_0, k_1, k_2 \in K$.
  Since $\{f,g,h\}$ is a reduced Gr\"obner basis, $h$ is the unique polynomial of this form, so $k = h$.
  As $k$ was generated by $f$ and $h$, so too must be $h$.
  Hence $I_D = \pid{f,g,h} = \pid{f,g}$.
\end{proof}

In \cite{kmakdisi18}, it is shown that typicality and semi-typicality are preserved by the flip operation.
\begin{theorem}
  A divisor $D$ is semi-typical if and only if its flip $\bar D$ is semi-typical.
\end{theorem}
\begin{proof}
  ($\implies$)
  Suppose $D$ is semi-typical.
  Let $f$ be the minimum polynomial in $I_D$.
  Then $-\nu_{P_\infty}(f) = \deg D + 3$.
  By Equation \ref{eq_flip_degree}, $\deg \bar D = 3$.
  Since $\bar D$ is reduced and of degree 3, $\bar D$ is of type 31, hence semi-typical.
  
  ($\impliedby$)
  Suppose $\bar D$ is semi-typical.
  Then $\bar D$ is of type 31.
  So, too, is $\bar{\bar D}$ of type 31, and $\bar{\bar D} \equiv D$.
  Let $I_{\bar {\bar D}} = \pid{u,v,w}$.
  Then $u$ is the minimum polynomial in $I_{\bar{\bar D}}$,
  $-\nu_{P_\infty}(u) = 6$, $-\nu_{P_\infty}(v) = 7$, and $-\nu_{P_\infty}(w) = 8$.
  Now let $f$ be the minimum polynomial in $I_D$.
  By Equation \ref{eq_flip_degree}, $-\nu_{P_\infty}(f) = \deg D + 3$.
  By Proposition \ref{prop_aI_B_is_bI_A},
  \[ fI_{\bar{\bar D}} = uI_D, \]
  hence $\pid{fu, fv, fw} = \pid{fu, gu, hu}$, and $fv = gu$ and $fw = hu$.
  Then
  \begin{align*}
    -\nu_{P_\infty}(fv) &= -\nu_{P_\infty}(gu) \\
    -\nu_{P_\infty}(v) + \nu_{P_\infty}(u) &= -\nu_{P_\infty}(g) + \nu_{P_\infty}(f) \\
    7 - 6 &= -\nu_{P_\infty}(g) - \deg D - 3\\
    -\nu_{P_\infty}(g) &=  \deg D + 4.
  \end{align*}
  Likewise, $-\nu_{P_\infty}(h) =  \deg D + 5$.
\end{proof}

\begin{theorem}
  \label{thm_typical_divisors_and_reduction}
  A divisor $D$ is typical if and only if its reduction $\bar{\bar D}$ is typical.
\end{theorem}
\begin{proof}
  ($\implies$)
  Let $I_D = \pid{f, g, h}$.
  Let $I_{\bar{\bar D}} = \pid{u, v, w}$.
  Since $D$ is typical, $h \in \pid{f, g}$,
  so there are polynomials $r, s \in K[C]$ such that $h = rf + sg$. Then
  \begin{align*}
    uI_D &= fI_{\bar{\bar D}} \\
    \pid{fu, gu, hu} &= \pid{fu, fv, fw} \\
    fw &= hu \\
       &= (rf + sg)u \\
       &= rfu + sfv \\
     w &= ru + sv,
  \end{align*}
  hence $w \in \pid{u,v}$.

  ($\impliedby$)
  Let $I_D = \pid{f, g, h}$.
  Let $I_{\bar{\bar D}} = \pid{u, v, w}$.
  Since $\bar{\bar D}$ is typical, $w \in \pid{u, v}$,
  so there are polynomials $r$ and $s$ such that $w = ru + sv$. Then, as above,
  \begin{align*}
    hu &= fw \\
       &= f(ru + sv) \\
       &= rfu + sgu \\
     h &= rf + sg.
  \end{align*}
\end{proof}

\begin{theorem}
  A divisor $D$ is typical if and only if its flip $\bar D$ is typical.
\end{theorem}
\begin{proof}
  We make use of many of the above theorems.
  
  ($\implies$)
  Suppose $D$ is typical.
  By Theorem \ref{thm_typical_divisors_and_reduction}, $\bar{\bar D}$ is typical.
  By Proposition \ref{prop_flip_properties}, $\bar{\bar D}$ is reduced.
  By Theorem \ref{thm_reduced_divisor_types} and Definition \ref{def_typical_divisor},
  $\bar{\bar D}$ is of type 31.
  Referring to Table \ref{tab_divisor_types},
  the minimum polynomial of $I_{\bar{\bar D}}$ is $f = x^2 + f_2y + f_1x + f_0$,
  and by Theorem \ref{thm_typical_type_31_divisors}, $f_2 \neq 0$.
  The flip $\bar{\bar{\bar D}}$ of $\bar{\bar D}$ is also of type 31 (Table \ref{tab_small_flip_type}),
  and since $f \in f : I_{\bar{\bar D}} = I_{\bar{\bar{\bar D}}}$,
  $I_{\bar{\bar{\bar D}}}$ shares the same minimum polynomial $f$ with $f_2 \neq 0$.
  Hence by Theorem \ref{thm_typical_type_31_divisors}, $\bar{\bar{\bar D}}$ is also typical.
  Since $\bar D$ is reduced (Proposition \ref{prop_flip_properties}),
  $\bar{\bar{\bar D}} = \bar D$ and the result follows.

  ($\impliedby$)
  Suppose $D$ is atypical.
  Then $\bar{\bar D}$ is atypical.
  
  If $\bar{\bar D}$ is of type 31, then by Theorem \ref{thm_typical_type_31_divisors},
  the minimum polynomial of $I_{\bar{\bar D}}$ is $f = x^2 + f_1x + f_0$.
  As in the previous part of this proof, $\bar D$ is also of type 31 with the same minimum polynomial $f$,
  hence $\bar D$ is atypical by Theorem \ref{thm_typical_type_31_divisors}.
  
  If $\bar{\bar D}$ is not of type 31, then $\bar D$ is of degree less than 3 (see Table \ref{tab_flip_degree})
  and cannot be typical.
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                           %%%%%
%%%%%   Semi-typical Divisors   %%%%%
%%%%%                           %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Semi-typical Divisors}
\label{sec_semitypical_divisors}

A divisor $D$ of type 31, 41, 51, or 61 may be typical or merely semi-typical.
The ideal $I_D$ of such a divisor is always generated by a Gr\"obner basis of three elements, $I_D = \pid{f,g,h}$.
Typically, the first two polynomials $f$ and $g$ are enough to generate the ideal, and $I_D = \pid{f,g}$.
That is, $h \in \pid{f,g}$, so there exist polynomials $r, s \in K[C]$ and a constant $t \in K$ such that
\begin{equation}
  \label{eq_rf_sg_th}
  rf + sg + th \equiv 0 \pmod F.
\end{equation}
\begin{lemma}
  \label{lem_fgh_is_fg_31}
  Let $I_D = \pid{f,g,h}$ be a type 31 divisor.
  Then a solution to Equation \ref{eq_rf_sg_th} is given by
  \begin{align*}
    r &= y + g_1 \\
    s &= -(x + f_1 - g_2) \\
    t &= -f_2,
  \end{align*}
  and $h \in \pid{f,g}$ if and only if $t \neq 0$.
\end{lemma}
\begin{proof}
  The $S$-polynomial $S(f, g) = yf - xg = f_2y^2 + \ldots$ reduces to 0 modulo $\pid{f,g,h}$
  (in the sense of Definition \ref{def_reduced_polynomial}).
  So there exist constants $r_0, s_0, t_0 \in K$ such that 
  \[ yf - xg - t_0h - s_0g - r_0f = 0. \]
  Solving for these constants gives $t_0 = f_2$, $s_0 = f_1 - g_2$, $r_0 = -g_1$.
  
  If $t = -f_2 \neq 0$, this gives $h$ in terms of $f$ and $g$.
  Conversely, if $h \in \pid{f,g}$, then $f$ and $g$ generate $I_D$, but are not a Gr\"obner basis.
  Following Buchberger's Algorithm produces $h$
  by reducing $S(f,g)$ modulo $\{f,g\}$, but this implies $t_0 \neq 0$ above.
\end{proof}
\begin{lemma}
  \label{lem_fgh_is_fg_61}
  Let $I_D = \pid{f,g,h}$ be a type 61 divisor.
  Then a solution to Equation \ref{eq_rf_sg_th} is given by
  \begin{align*}
    r &= y + f_5x + (g_3 - f_5(f_3 - c_6)) \\
    s &= -(x + f_5(f_4 - c_7) + f_3 - g_4) \\
    t &= -(f_5(f_5 - c_8) + f_4 - g_5),
  \end{align*}
  and $h \in \pid{f,g}$ if and only if $t \neq 0$.
\end{lemma}
Just as a type 31 divisor is typical if and only if $f_2 \neq 0$,
a type 61 divisor is typical if and only if $f_5(f_5 - c_8) + f_4 - g_5 \neq 0$.
The proof of Lemma \ref{lem_fgh_is_fg_61} is almost identical to that of \ref{lem_fgh_is_fg_31}, so we omit it.

If $D$ is semi-typical but not typical,
it may still be the case that $\pid{f,h} = \pid{f,g,h}$.
In this case, $g \in \pid{f,h}$ and there exist polynomials $r', t' \in K[C]$ and a constant $s' \in K$ such that
\begin{equation}
  \label{eq_r'f_s'g_t'h}
  r'f + s'g + t'h \equiv 0 \pmod F.
\end{equation}
\begin{lemma}
  \label{lem_fgh_is_fh_31}
  Let $I_D = \pid{f,g,h}$ be a type 31 divisor.
  Then a solution to Equation \ref{eq_r'f_s'g_t'h} is given by
  \begin{align*}
    r' &= x^2 + r'_2y + r'_1x + r'_0 \\
    s' &= s'_0 \\
    t' &= y + t'_1x + t'_0
  \end{align*}
  where
  \begin{align*}
    t'_1 &= c_8 \\
    r'_2 &= c_7 - f_2\\
    r'_1 &= c_6 - f_1 \\
    t'_0 &= -f_2r'_2 + c_5 - h_2 \\
    s'_0 &= -f_2r'_1 - f_1r'_2 - h_2t'_1 + c_4 - h_1 \\
    r'_0 &= -f_1r'_1 - h_1t'_1 + c_3 - f_0,
  \end{align*}
  and $g \in \pid{f,h}$ if and only if $s' \neq 0$.
\end{lemma}
\begin{lemma}
  \label{lem_fgh_is_fh_61}
  Let $I_D = \pid{f,g,h}$ be a type 61 divisor.
  Then a solution to Equation \ref{eq_r'f_s'g_t'h} is given by
  \begin{align*}
    r' &= x^2 + r'_2y + r'_1x + r'_0 \\
    s' &= s'_0 \\
    t' &= y + t'_1x + t'_0
  \end{align*}
  where
  \begin{align*}
    t'_1 &= c_8 - f_5 \\
    r'_2 &= c_7 - f_4\\
    r'_1 &= f_5r'_2 + c_6 - f_3 + h_5 \\
    t'_0 &= c_8f_5r'_2 + c_8h_5 - f_5r'_1 - f_4r'_2 - h_5t'_1 + c_5 - h_4 \\
    s'_0 &= c_7f_5r'_2 + c_7h_5 - f_4r'_1 - f_3r'_2 - h_4t'_1 + c_4 - f_2 - h_4 \\
    r'_0 &= c_6f_5r'_2 + c_6h_5 - f_3r'_1 - h_3t_1 + c_3 - f_1,
  \end{align*}
  and $g \in \pid{f,h}$ if and only if $s' \neq 0$.
\end{lemma}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                               %%%%%
%%%%%   Geometric Interpretations   %%%%%
%%%%%                               %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Geometric Interpretations}

Here, we ascribe some geometric meaning to each divisor type of degree 3 or less.

%\subsubsection{Type 0}
%  There is only one type 0 divisor, the zero divisor, i.e. the empty sum.

\subsubsection{Type 11}
  If $D$ is of type 11, then $I_D = \pid{x - x_0, y - y_0}$, and $D = P$ where $P$ is the point $(x_0, y_0)$.
  Since $x - x_0$ and $y - y_0$ have $K$-rational coefficients, $P$ is a $K$-rational point.
  If $C$ is defined over a finite field $\bb F_q$,
  by the Hasse-Weil Bound (Theorem \ref{thm_hasse_weil}), there are approximately $q$ type 11 divisors on $C$.

\subsubsection{Type 21}
  Either $D = P + Q$ for distinct points $P \neq Q$, or $D = 2P$.
  
  The former case $D = P + Q$ occurs if and only if $f = x^2 + f_1x + f_0$ has two distinct roots, $x_0$ and $x_1$.
  Then $P = (x_0, y_0)$ and $Q = (x_1, y_1)$, where $y_i = -g_1x_i - g_0$ are obtained by solving $g(x_i, y_i) = 0$.
  
  The latter case $D = 2P$ occurs if and only if $f$ has a double root.
  In this case, $g$ is the tangent line to $C$ at $P$, necessarily non-vertical.

\subsubsection{Type 22}
  Either $D = P + Q$ for distinct points $P \neq Q$, or $D = 2P$.

  The former case $D = P + Q$ occurs if and only if $g = y^2 + g_2y + g_0$ has two distinct roots, $y_0$ and $y_1$.
  Then $P = (-f_0, y_0)$ and $Q = (-f_0, y_1)$.

  The latter case $D = 2P$ occurs if and only if $g$ has a double root.
  In this case, $f$ is the vertical tangent line to $C$ at $P$.

\begin{comment}
\subsubsection{Type 21}
  If $D$ is of type 21, then $I_D = \pid{f, g}$, where $f$ is the non-vertical line $y + f_1x + f_0$
  and $g$ is the univariate polynomial $x^2 + g_1x + g_0$.
  Thus $D$ is the sum of two points on the line $f$, whose $x$-coordinates are the roots of $g$.
  
  There are two possibilities.
  If $g$ has two distinct roots, then $D = P + Q$ for two distinct points $P$ and $Q$.
  If $g$ has a double root, then $D = 2P$ and $f$ is the tangent line at $P$.
  
  So either $D$ is the sum of two distinct points with different $x$-coordinates,
  or $D$ is a double point $D = 2P$ and the tangent line at $P$ is non-vertical.
\end{comment}
\begin{comment}
\subsubsection{Type 22}
  If $D$ is of type 21, then $I_D = \pid{f, g}$, where $f$ is the vertical line $x + f_0$
  and $g$ is the univariate polynomial $y^2 + g_2y + g_0$.
  
  Either $D = P + Q$ is the sum of two distinct points with the same $x$-coordinate but different $y$-coordinates,
  or $D = 2P$ is a double point and the tangent line at $P$ is vertical.
\end{comment}

\subsubsection{Type 31}
  If $D$ is of type 31, then $I_D = \pid{f, g, h}$,
  where $f$ is the vertically-opening parabola $x^2 + f_2y + f_1x + f_0$,
  $g$ is the hyperbola $xy + g_2y + g_1x + g_0$,
  and $h$ is the horizontally-opening parabola $y^2 + h_2y + h_1x + h_0$.
  
  Either $D$ is the sum of three distinct points,
  the sum of a double point with a second distinct point,
  or a triple points.
  
  If $D = P + Q + R$ is the sum of three distinct points, then these points are non-collinear.
  If $D = 2P + Q$ is the sum of a double point with a second distinct point,
  then the tangent line at $P$ does not pass through $Q$.
  If $D = 3P$ is a triple point, then the $P$ is not an inflection point.

\subsubsection{Type 32}
  If $D$ is of type 32, then $I_D = \pid{f, g}$, where $f$ is the non-vertical line $y + f_1x + f_0$
  and $g$ is the univariate polynomial $x^3 + g_3x^2 + g_1x + g_0$.
  Thus all points in $D$ must be collinear, falling on the line $f$.
  
  If $D = P + Q + R$ is the sum of three distinct points, then their $x$-coordinates are the roots of $g$.
  If $D = 2P + Q$ for distinct $P$ and $Q$, then the tangent line at $P$ is $f$, which also passes through $Q$,
  and the $x$-coordinate of $P$ is a double root of $g$.
  If $D = 3P$ is a triple point, then $P$ is an inflection point, $f$ is the tangent line at $P$, and $g$ has a triple root,
  the $x$-coordinate of $P$.

\subsubsection{Type 33}
  If $D$ is of type 32, then $I_D = \pid{f}$ is a principal ideal and $f$ is the vertical line $x + f_0$.
  The points in $D$ necessarily have the same $x$-coordinate, $-f_0$.
  If $D = P + Q + R$ is the sum of three distinct points, then these points have pairwise distinct $y$-coordinates.
  If $D = 2P + Q$, for distinct $P$ and $Q$, then $P$ and $Q$ have distinct $y$-coordinates and $f$ is the tangent line at $P$, which passes also through $Q$.
  If $D = 3P$ is a triple point, then $P$ is an inflection point and $f$ is the tangent line at $P$.



